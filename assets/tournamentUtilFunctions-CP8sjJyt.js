import{j as i}from"./index-Cj-npikX.js";const y=t=>{for(var e=t.length-1;e>0;e--){var l=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[l],t[l]=s}return t},g=t=>t.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(e)).join(""),T=(t,e,l)=>{let s=0;return d(t,e,l).forEach(r=>{r.team1.name==e&&r.result.team1Score>r.result.team2Score&&s++,r.team2.name==e&&r.result.team2Score>r.result.team1Score&&s++}),s},w=(t,e,l)=>{let s=0;return d(t,e,l).forEach(r=>{r.team1.name==e&&(s+=r.result.team1Score),r.team2.name==e&&(s+=r.result.team2Score)}),s},O=(t,e,l)=>{let s=0;return d(t,e,l).forEach(r=>{r.team1.name==e&&(s+=r.result.team2Score),r.team2.name==e&&(s+=r.result.team1Score)}),s},F=(t,e,l)=>{let s=0,a=0;return d(t,e,l).forEach(o=>{o.team1.name==e&&(a+=o.result.team2Score),o.team2.name==e&&(a+=o.result.team1Score),o.team1.name==e&&o.result.team1Score<o.result.team2Score&&(s+=o.result.team2Score-o.result.team1Score),o.team2.name==e&&o.result.team1Score>o.result.team2Score&&(s+=o.result.team1Score-o.result.team2Score)}),s+a},v=(t,e,l)=>{let s=0;return S(t,e,l).forEach(r=>{r.team1.players[0]==e&&(s+=r.result.team1Player1Score),r.team1.players[1]==e&&(s+=r.result.team1Player2Score),r.team2.players[0]==e&&(s+=r.result.team2Player1Score),r.team2.players[1]==e&&(s+=r.result.team2Player2Score)}),s},I=(t,e,l)=>S(t,e,l).length,G=(t,e,l)=>{let s=0;return S(t,e,l).forEach(r=>{(r.team1.players[0]==e||r.team1.players[1]==e)&&r.result.team1Score>r.result.team2Score&&s++,(r.team2.players[0]==e||r.team2.players[1]==e)&&r.result.team2Score>r.result.team1Score&&s++}),s},k=(t,e,l)=>{let s=!1;return D(t).forEach(r=>{r.forEach(o=>{o.result&&o.team1.name==e&&o.team2.name==l&&(s=o.result.team1Score>o.result.team2Score)})}),s},b=async t=>{let e=await i.post("/createTournament",t);return console.log(e.data.message),e.data.success},R=async()=>{let t=await i.get("/tournaments");if(console.log(t.data.message),t.data.success)return t.data.tournaments},j=async t=>{let e=await i.post("/getTournamentByName",{tournamentName:t});if(console.log(e.data.message),e.data.success)return e.data.tournament},V=async t=>{let e=t.replaceAll("-"," ");(t=="2020"||t=="2021"||t=="2022"||t=="2023"||t=="2024"||t=="2025"||t=="2026"||t=="2027")&&(e="Weck BiPo Open "+t);let l=await i.post("/getTournamentByName",{tournamentName:e});if(console.log(l.data.message),l.data.success)return l.data.tournament},q=async(t,e)=>{let l=await i.post("/setSettings",{tournamentID:t,settings:e});return console.log(l.data.message),l.data.success},W=t=>{if(!t)return[];let e=[],l=x(t);for(let s=0;s<l.length;s++)for(let a=0;a<l[s].players.length;a++){let r=I(t,l[s].players[a],!1),o=v(t,l[s].players[a],!1),m=G(t,l[s].players[a],!1),u={name:l[s].players[a],score:o,ammountOfMatches:r,ammountOfDrunkenCups:Math.ceil(F(t,l[s].name,!1)/2),wins:m,averageScore:Math.round((r==0?0:o/r)*100)/100,averageWins:Math.round((r==0?0:m/r)*100)/100};e.push(u)}return e},z=t=>{let e=W(t);e.sort((l,s)=>s.averageScore==l.averageScore?s.ammountOfDrunkenCups-l.ammountOfDrunkenCups:s.averageScore-l.averageScore);for(let l=0;l<e.length;l++){e[l].placement=l;let s=e.filter(a=>a.averageScore==e[l].averageScore&&a.ammountOfDrunkenCups==e[l].ammountOfDrunkenCups);s.length>1&&s.forEach(a=>{a.placement=s[0].placement})}return e},S=(t,e,l)=>{let s=[],a=D(t);return l||(a=a.concat(p(t))),a.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.players[0]==e||o.team1.players[1]==e||o.team2.players[0]==e||o.team2.players[1]==e)&&s.push({_id:o._id,team1:o.team1,team2:o.team2,result:o.result})})}),s},L=async(t,e)=>{let l=await i.post("/addTeam",{tournamentID:t,team:e});return console.log(l.data.message),l.data.success},J=async(t,e)=>{let l=await i.post("/editTeam",{tournamentID:t,team:e});return console.log(l.data.message),l.data.success},Q=async(t,e)=>{let l=await i.post("/removeTeam",{tournamentID:t,teamID:e});return console.log(l.data.message),l.data.success},h=(t,e)=>t.teams.find(s=>s._id==e),U=(t,e)=>t.teams.find(s=>s.name==e),x=t=>{if(!t)return[];let e=[];return t.teams.forEach(l=>{e.push(l)}),e},A=t=>{if(!t)return[];let e=p(t);for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(!e[s][a].result)return[];let l=[];if(e.length>0){let s=e[e.length-1][0],a=s.result.team1Score>s.result.team2Score?s.team1:s.team2,r=s.result.team1Score>s.result.team2Score?s.team2:s.team1,o=e[e.length-1][1],m=o.result.team1Score>o.result.team2Score?o.team1:o.team2,u=o.result.team1Score>o.result.team2Score?o.team2:o.team1;l.push(a),l.push(r),l.push(m),l.push(u)}return l},d=(t,e,l)=>{let s=[],a=D(t);return l||(a=a.concat(p(t))),a.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.name==e||o.team2.name==e)&&s.push({_id:o._id,team1:o.team1,team2:o.team2,result:o.result})})}),s},X=t=>{let e=[],l=H(t);for(let s=0;s<l.length;s++){let a=w(t,l[s].name,!1),r=O(t,l[s].name,!1),o={name:l[s].name,players:l[s].players,wins:T(t,l[s].name,!1),games:I(t,l[s].players[0],!1),score:a+" : "+r,scoreDifference:a-r,hits:a};e.push(o)}e=e.sort((s,a)=>s.games==a.games?a.wins-s.wins:a.games-s.games);for(let s=0;s<e.length;s++){e[s].placement=s;let a=A(t),r=a.map(o=>o.name).includes(e[s].name);if(!r){let o=e.filter(m=>m.games==e[s].games);o.length>1&&o.forEach(m=>{m.placement=o[0].placement})}r&&(e[s].placement=a.map(o=>o.name).indexOf(e[s].name))}return e=e.sort((s,a)=>s.placement-a.placement),e},_=t=>{if(!t||!t.groupPhase.groups)return[];let e=[];return t.groupPhase.groups.forEach((l,s)=>{let a=[];e.push({teams:a}),l.teams.forEach(r=>{let o=h(t,r.teamID);e[s].teams.push(o)})}),e},K=async(t,e)=>{let l=await i.post("/setGroups",{tournamentID:t,groups:e});return console.log(l.data.message),l.data.success},Y=async t=>{let e=[],l=y(t.teams),s=t.settings.fixedGroupAmmount;for(let a=0;a<s;a++)e.push({teams:[]});for(let a=0;a<l.length;a++)e[a%s].teams.push({teamID:l[a]._id});await K(t._id,e)},C=t=>{let e=[],l=_(t);for(let s=0;s<l.length;s++){e.push({teams:[]});for(let a=0;a<l[s].teams.length;a++){let r=w(t,l[s].teams[a].name,!0),o=O(t,l[s].teams[a].name,!0),m={name:l[s].teams[a].name,players:l[s].teams[a].players,wins:T(t,l[s].teams[a].name,!0),games:I(t,l[s].teams[a].players[0],!0),score:r+" : "+o,scoreDifference:r-o,hits:r};e[s].teams.push(m)}}return e.forEach(s=>{s.teams=s.teams.sort((a,r)=>a.hits==r.hits&&a.scoreDifference==r.scoreDifference&&a.wins==r.wins?k(t,a.name,r.name)?1:-1:r.scoreDifference==a.scoreDifference&&a.wins==r.wins?r.hits-a.hits:a.wins==r.wins?r.scoreDifference-a.scoreDifference:r.wins-a.wins)}),e},D=t=>{if(!t||!t.groupPhase.matches)return[];let e=[];return t.groupPhase.matches.forEach((l,s)=>{e.push([]),l.forEach(a=>{e[s].push({result:a.result,team1:h(t,a.team1ID),team2:h(t,a.team2ID),_id:a._id})})}),e},E=async(t,e)=>{let l=await i.post("/setMatchesGroupPhase",{tournamentID:t,matches:e});return console.log(l.data.message),l.data.success},Z=async t=>{let e=[],l=_(t);for(let s=0;s<l.length;s++){let a=[],r=l[s].teams,o=r.length*(r.length-1)/2;if(o==10)a.push({team1ID:r[0]._id,team2ID:r[1]._id}),a.push({team1ID:r[2]._id,team2ID:r[3]._id}),a.push({team1ID:r[0]._id,team2ID:r[4]._id}),a.push({team1ID:r[1]._id,team2ID:r[3]._id}),a.push({team1ID:r[2]._id,team2ID:r[4]._id}),a.push({team1ID:r[0]._id,team2ID:r[3]._id}),a.push({team1ID:r[1]._id,team2ID:r[2]._id}),a.push({team1ID:r[3]._id,team2ID:r[4]._id}),a.push({team1ID:r[0]._id,team2ID:r[2]._id}),a.push({team1ID:r[1]._id,team2ID:r[4]._id});else if(o==6)a.push({team1ID:r[2]._id,team2ID:r[3]._id}),a.push({team1ID:r[0]._id,team2ID:r[1]._id}),a.push({team1ID:r[2]._id,team2ID:r[1]._id}),a.push({team1ID:r[0]._id,team2ID:r[3]._id}),a.push({team1ID:r[0]._id,team2ID:r[2]._id}),a.push({team1ID:r[1]._id,team2ID:r[3]._id});else if(o==3)a.push({team1ID:r[0]._id,team2ID:r[1]._id}),a.push({team1ID:r[0]._id,team2ID:r[2]._id}),a.push({team1ID:r[1]._id,team2ID:r[2]._id});else{for(let m=0;m<r.length;m++)for(let u=m+1;u<r.length;u++){let n={team1ID:r[u]._id,team2ID:r[m]._id};a.push(n)}a=y(a)}e.push(a)}await E(t._id,e)},$=async(t,e,l)=>{let s=t.groupPhase.matches;for(let a=0;a<s.length;a++)for(let r=0;r<s[a].length;r++)e==s[a][r]._id&&(s[a][r].result=l);await E(t._id,s),await M(t)},H=t=>{if(!t||!t.koPhase.matches)return[];let e=[];return p(t).forEach(s=>{s.forEach(a=>{a.team1&&!e.includes(a.team1)&&e.push(a.team1),a.team2&&!e.includes(a.team2)&&e.push(a.team2)})}),e},p=t=>{if(!t||!t.koPhase.matches)return[];let e=[];return t.koPhase.matches.forEach((l,s)=>{e.push([]),l.forEach(a=>{e[s].push({result:a.result,team1:h(t,a.team1ID),team2:h(t,a.team2ID),_id:a._id})})}),e},P=async(t,e)=>{let l=await i.post("/setMatchesKOPhase",{tournamentID:t,matches:e});return console.log(l.data.message),l.data.success},N=async t=>{let e=[],l=t.settings.advancingTeamsPerGroup*t.groupPhase.groups.length,s=Math.log2(l);for(let a=0;a<s;a++){let r=l/Math.pow(2,a+1);if(e.push([]),a==0)for(let o=0;o<r;o++)o%2==0?(g(o+1),g(o+2)):(g(r-o+1),g(r-o))}await P(t._id,e)},M=async t=>{let e=[],l=t.koPhase.matches,s=_(t),a=C(t);l.forEach((r,o)=>{if(e.push([]),o==0)for(let m=0;m<r.length;m++){let u=r[m],n,c;m%2==0?(n=m,c=m+1):(n=r.length-m,c=r.length-m-1),t.name=="Weck BiPo Open 2022"&&(m==0&&(n=2,c=0),m==1&&(n=3,c=1),m==2&&(n=0,c=3),m==3&&(n=1,c=2)),t.groupPhase.matches[n].find(f=>!f.result)||(u.team1ID=s[n].teams.find(f=>f.name==a[n].teams[0].name)._id),t.groupPhase.matches[c].find(f=>!f.result)||(u.team2ID=s[c].teams.find(f=>f.name==a[c].teams[1].name)._id),e[o].push(u)}else if(o==l.length-1){let m=r[0],u=r[1],n=l[o-1][0],c=l[o-1][1];n.result&&(m.team1ID=n.result.team1Score>n.result.team2Score?n.team1ID:n.team2ID,u.team1ID=n.result.team1Score>n.result.team2Score?n.team2ID:n.team1ID),c.result&&(m.team2ID=c.result.team1Score>c.result.team2Score?c.team1ID:c.team2ID,u.team2ID=c.result.team1Score>c.result.team2Score?c.team2ID:c.team1ID),e[o].push(m),e[o].push(u)}else for(let m=0;m<r.length;m++){let u=r[m],n=l[o-1][m*2],c=l[o-1][m*2+1];n.result&&(u.team1ID=n.result.team1Score>n.result.team2Score?n.team1ID:n.team2ID),c.result&&(u.team2ID=c.result.team1Score>c.result.team2Score?c.team1ID:c.team2ID),e[o].push(u)}}),await P(t._id,e)},ee=async(t,e,l)=>{let s=t.koPhase.matches;for(let a=0;a<s.length;a++)for(let r=0;r<s[a].length;r++)e==s[a][r]._id&&(s[a][r].result=l);await P(t._id,s),await M(t)},te=t=>{let e=!0,l=D(t);return l=l.concat(p(t)),l.forEach(s=>{s.forEach(a=>{a.result||(e=!1)})}),e};export{$ as A,ee as B,W as a,C as b,g as c,te as d,X as e,z as f,V as g,D as h,x as i,A as j,p as k,F as l,R as m,b as n,L as o,J as p,_ as q,Q as r,q as s,U as t,K as u,Z as v,N as w,Y as x,j as y,E as z};
