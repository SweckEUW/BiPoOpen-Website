import{z as i}from"./index-CXEQOig3.js";const T=s=>{for(var e=s.length-1;e>0;e--){var l=Math.floor(Math.random()*(e+1)),a=s[e];s[e]=s[l],s[l]=a}return s},h=s=>s.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(e)).join(""),I=(s,e,l)=>{let a=0;return p(s,e,l).forEach(r=>{r.team1.name==e&&r.result.team1Score>r.result.team2Score&&a++,r.team2.name==e&&r.result.team2Score>r.result.team1Score&&a++}),a},O=(s,e,l)=>{let a=0;return p(s,e,l).forEach(r=>{r.team1.name==e&&(a+=r.result.team1Score),r.team2.name==e&&(a+=r.result.team2Score)}),a},_=(s,e,l)=>{let a=0;return p(s,e,l).forEach(r=>{r.team1.name==e&&(a+=r.result.team2Score),r.team2.name==e&&(a+=r.result.team1Score)}),a},M=(s,e,l)=>{let a=0,t=0;return p(s,e,l).forEach(o=>{o.team1.name==e&&(t+=o.result.team2Score),o.team2.name==e&&(t+=o.result.team1Score),o.team1.name==e&&o.result.team1Score<o.result.team2Score&&(a+=o.result.team2Score-o.result.team1Score),o.team2.name==e&&o.result.team1Score>o.result.team2Score&&(a+=o.result.team1Score-o.result.team2Score)}),a+t},F=(s,e,l)=>{let a=0;return S(s,e,l).forEach(r=>{r.team1.players[0]==e&&(a+=r.result.team1Player1Score),r.team1.players[1]==e&&(a+=r.result.team1Player2Score),r.team2.players[0]==e&&(a+=r.result.team2Player1Score),r.team2.players[1]==e&&(a+=r.result.team2Player2Score)}),isNaN(a)&&(a=0),a},D=(s,e,l)=>S(s,e,l).length,G=(s,e,l)=>{let a=0;return S(s,e,l).forEach(r=>{(r.team1.players[0]==e||r.team1.players[1]==e)&&r.result.team1Score>r.result.team2Score&&a++,(r.team2.players[0]==e||r.team2.players[1]==e)&&r.result.team2Score>r.result.team1Score&&a++}),a},H=(s,e,l)=>{let a=!1;return g(s).forEach(r=>{r.forEach(o=>{o.result&&o.team1._id==e&&o.team2._id==l&&(a=o.result.team1Score>o.result.Team2ID)})}),a},B=async s=>{let e=await i.post("/getTournamentByName",{tournamentName:s});if(console.log(e.data.message),e.data.success)return e.data.tournament},b=async s=>{let e=s.replaceAll("-"," ");s.includes("20")&&(e="Weck BiPo Open "+s);let l=await i.post("/getTournamentByName",{tournamentName:e});if(console.log(l.data.message),l.data.success)return l.data.tournament},R=async(s,e)=>{let l=await i.post("/setSettings",{tournamentID:s,settings:e});return console.log(l.data.message),l.data.success},v=s=>{if(!s)return[];let e=[],l=k(s);for(let a=0;a<l.length;a++)for(let t=0;t<l[a].players.length;t++){let r={name:l[a].players[t],score:F(s,l[a].players[t],!1),ammountOfMatches:D(s,l[a].players[t],!1),ammountOfDrunkenCups:Math.ceil(M(s,l[a].name,!1)/2),wins:G(s,l[a].players[t],!1)};r.averageScore=(r.ammountOfMatches==0?0:r.score/r.ammountOfMatches).toFixed(2),r.averageWins=(r.ammountOfMatches==0?0:r.wins/r.ammountOfMatches).toFixed(2),e.push(r)}return e},z=s=>{let e=v(s);e.sort((l,a)=>a.averageScore==l.averageScore?a.ammountOfDrunkenCups-l.ammountOfDrunkenCups:a.averageScore-l.averageScore);for(let l=0;l<e.length;l++){e[l].placement=l;let a=e.filter(t=>t.averageScore==e[l].averageScore&&t.ammountOfDrunkenCups==e[l].ammountOfDrunkenCups);a.length>1&&a.forEach(t=>{t.placement=a[0].placement})}return e},S=(s,e,l)=>{let a=[],t=g(s);return l||(t=t.concat(f(s))),t.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.players[0]==e||o.team1.players[1]==e||o.team2.players[0]==e||o.team2.players[1]==e)&&a.push(o)})}),a},L=async(s,e)=>{let l=await i.post("/addTeam",{tournamentID:s,team:e});return console.log(l.data.message),l.data.success},V=async(s,e)=>{let l=await i.post("/editTeam",{tournamentID:s,team:e});return console.log(l.data.message),l.data.success},j=async(s,e)=>{let l=await i.post("/removeTeam",{tournamentID:s,teamID:e});return console.log(l.data.message),l.data.success},n=(s,e)=>s.teams.find(a=>a._id==e),q=(s,e)=>s.teams.find(a=>a.name==e),k=s=>{if(!s)return[];let e=[];return s.teams.forEach(l=>{e.push(l)}),e},x=s=>{if(!s)return[];let e=f(s);for(let a=0;a<e.length;a++)for(let t=0;t<e[a].length;t++)if(!e[a][t].result)return[];let l=[];if(e.length>0){let a=e[e.length-1][0],t=a.result.team1Score>a.result.team2Score?a.team1:a.team2,r=a.result.team1Score>a.result.team2Score?a.team2:a.team1,o=e[e.length-1][1],c=o.result.team1Score>o.result.team2Score?o.team1:o.team2,m=o.result.team1Score>o.result.team2Score?o.team2:o.team1;l.push(t),l.push(r),l.push(c),l.push(m)}return l},p=(s,e,l)=>{let a=[],t=g(s);return l||(t=t.concat(f(s))),t.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.name==e||o.team2.name==e)&&a.push(o)})}),a},J=s=>{let e=[];A(s).forEach(a=>{let t=a,r=O(s,t.name,!1),o=_(s,t.name,!1);t.wins=I(s,t.name,!1),t.games=D(s,t.players[0],!1),t.score=r+" : "+o,t.scoreDifference=r-o,t.hits=r,e.push(t)}),e=e.sort((a,t)=>a.games==t.games?t.wins-a.wins:t.games-a.games);for(let a=0;a<e.length;a++){e[a].placement=a;let t=x(s);if(!t.includes(e[a])){let r=e.filter(o=>o.games==e[a].games);r.length>1&&r.forEach(o=>{o.placement=r[0].placement})}t.includes(e[a])&&(e[a].placement=t.indexOf(e[a]))}return e=e.sort((a,t)=>a.placement-t.placement),e},y=s=>{if(!s||!s.groupPhase.groups)return[];let e=[];return s.groupPhase.groups.forEach((l,a)=>{e.push({teams:[]}),l.teams.forEach(t=>{let r=n(s,t.teamID);e[a].teams.push(r)})}),e},W=async(s,e)=>{let l=await i.post("/setGroups",{tournamentID:s,groups:e});return console.log(l.data.message),l.data.success},Q=async s=>{let e=[],l=T(s.teams),a=s.settings.fixedGroupAmmount;for(let t=0;t<a;t++)e.push({teams:[]});for(let t=0;t<l.length;t++)e[t%a].teams.push({teamID:l[t]._id});await W(s._id,e)},K=s=>{if(!s)return[];let e=[];return y(s).forEach((a,t)=>{e.push({teams:[]}),a.teams.forEach(r=>{let o=r,c=O(s,o.name,!0),m=_(s,o.name,!0);o.wins=I(s,o.name,!0),o.games=D(s,o.players[0],!0),o.score=c+" : "+m,o.scoreDifference=c-m,o.hits=c,e[t].teams.push(o)})}),e.forEach(a=>{a.teams=a.teams.sort((t,r)=>t.hits==r.hits&&t.scoreDifference==r.scoreDifference&&t.wins==r.wins?H(s,t._id,r._id):r.scoreDifference==t.scoreDifference&&t.wins==r.wins?r.hits-t.hits:t.wins==r.wins?r.scoreDifference-t.scoreDifference:r.wins-t.wins)}),e},g=s=>{if(!s||!s.groupPhase.matches)return[];let e=[];return s.groupPhase.matches.forEach((l,a)=>{e.push([]),l.forEach(t=>{e[a].push({result:t.result,team1:n(s,t.team1ID),team2:n(s,t.team2ID),_id:t._id})})}),e},w=async(s,e)=>{let l=await i.post("/setMatchesGroupPhase",{tournamentID:s,matches:e});return console.log(l.data.message),l.data.success},U=async s=>{let e=[],l=y(s);for(let a=0;a<l.length;a++){let t=[],r=l[a].teams,o=r.length*(r.length-1)/2;if(o==6)t.push({team1ID:r[2]._id,team2ID:r[3]._id}),t.push({team1ID:r[0]._id,team2ID:r[1]._id}),t.push({team1ID:r[2]._id,team2ID:r[1]._id}),t.push({team1ID:r[0]._id,team2ID:r[3]._id}),t.push({team1ID:r[0]._id,team2ID:r[2]._id}),t.push({team1ID:r[1]._id,team2ID:r[3]._id}),e.push(t);else if(o==3)console.log(r[0]),t.push({team1ID:r[0]._id,team2ID:r[1]._id}),t.push({team1ID:r[0]._id,team2ID:r[2]._id}),t.push({team1ID:r[1]._id,team2ID:r[2]._id}),e.push(t);else{for(let c=0;c<r.length;c++)for(let m=c+1;m<r.length;m++){let u={team1ID:r[m]._id,team2ID:r[c]._id};t.push(u)}t=T(t),e.push(t)}}await w(s._id,e)},X=async(s,e,l)=>{let a=s.groupPhase.matches;for(let t=0;t<a.length;t++)for(let r=0;r<a[t].length;r++)e==a[t][r]._id&&(a[t][r].result=l);await w(s._id,a),await E(s)},A=s=>{if(!s||!s.koPhase.matches)return[];let e=[];return f(s).forEach(a=>{a.forEach(t=>{t.team1&&!e.includes(t.team1)&&e.push(t.team1),t.team2&&!e.includes(t.team2)&&e.push(t.team2)})}),e},f=s=>{if(!s||!s.koPhase.matches)return[];let e=[];return s.koPhase.matches.forEach((l,a)=>{e.push([]),l.forEach(t=>{e[a].push({placeHolderTeam1:t.placeHolderTeam1,placeHolderTeam2:t.placeHolderTeam2,result:t.result,team1:n(s,t.team1ID),team2:n(s,t.team2ID),_id:t._id})})}),e},P=async(s,e)=>{let l=await i.post("/setMatchesKOPhase",{tournamentID:s,matches:e});return console.log(l.data.message),l.data.success},Y=async s=>{let e=[],l=s.settings.advancingTeamsPerGroup*s.groupPhase.groups.length,a=Math.log2(l);for(let t=0;t<a;t++){let r=l/Math.pow(2,t+1);if(e.push([]),t==0)for(let o=0;o<r;o++){let c,m;o%2==0?(c=h(o+1),m=h(o+2)):(c=h(r-o+1),m=h(r-o)),e[t].push({placeHolderTeam1:"1. Platz - Gruppe "+c,placeHolderTeam2:"2. Platz - Gruppe "+m})}else{for(let o=0;o<r;o++)e[t].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"});t==a-1&&e[t].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"})}}await P(s._id,e)},E=async s=>{let e=[],l=s.koPhase.matches,a=K(s);l.forEach((t,r)=>{if(e.push([]),r==0)for(let o=0;o<t.length;o++){let c=t[o],m,u;o%2==0?(m=o,u=o+1):(m=t.length-o,u=t.length-o-1),s.name=="Weck BiPo Open 2022"&&(o==0&&(m=2,u=0),o==1&&(m=3,u=1),o==2&&(m=0,u=3),o==3&&(m=1,u=2)),s.groupPhase.matches[m].find(d=>!d.result)||(c.team1ID=a[m].teams[0]._id),s.groupPhase.matches[u].find(d=>!d.result)||(c.team2ID=a[u].teams[1]._id),e[r].push(c)}else if(r==l.length-1){let o=t[0],c=t[1],m=l[r-1][0],u=l[r-1][1];m.result&&(o.team1ID=m.result.team1Score>m.result.team2Score?m.team1ID:m.team2ID,c.team1ID=m.result.team1Score>m.result.team2Score?m.team2ID:m.team1ID),u.result&&(o.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID,c.team2ID=u.result.team1Score>u.result.team2Score?u.team2ID:u.team1ID),e[r].push(o),e[r].push(c)}else for(let o=0;o<t.length;o++){let c=t[o],m=l[r-1][o*2],u=l[r-1][o*2+1];m.result&&(c.team1ID=m.result.team1Score>m.result.team2Score?m.team1ID:m.team2ID),u.result&&(c.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID),e[r].push(c)}}),await P(s._id,e)},Z=async(s,e,l)=>{let a=s.koPhase.matches;for(let t=0;t<a.length;t++)for(let r=0;r<a[t].length;r++)e==a[t][r]._id&&(a[t][r].result=l);await P(s._id,a),await E(s)},$=s=>{let e=!0,l=g(s);return l=l.concat(f(s)),l.forEach(a=>{a.forEach(t=>{t.result||(e=!1)})}),e};export{v as a,K as b,h as c,$ as d,J as e,z as f,b as g,g as h,k as i,x as j,f as k,M as l,L as m,V as n,y as o,q as p,W as q,j as r,R as s,U as t,Y as u,Q as v,B as w,w as x,X as y,Z as z};
