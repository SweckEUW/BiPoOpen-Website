import{s as m}from"./index-f1fd3e69.js";const S=t=>{for(var e=t.length-1;e>0;e--){var o=Math.floor(Math.random()*(e+1)),a=t[e];t[e]=t[o],t[o]=a}return t},h=t=>t.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(e)).join(""),_=(t,e,o)=>{let a=0,s=f(t);return o||(s=s.concat(n(t))),s.forEach(l=>{l.forEach(r=>{r.result&&(r.team1.name==e&&r.result.team1Score>r.result.team2Score&&(a+=1),r.team2.name==e&&r.result.team2Score>r.result.team1Score&&(a+=1))})}),a},I=(t,e,o)=>{let a=0,s=f(t);return o||(s=s.concat(n(t))),s.forEach(l=>{l.forEach(r=>{r.result&&(r.team1._id==e&&(a+=r.result.team1Score),r.team2._id==e&&(a+=r.result.team2Score))})}),a},y=(t,e,o)=>{let a=0,s=f(t);return o||(s=s.concat(n(t))),s.forEach(l=>{l.forEach(r=>{r.result&&(r.team1.players[0]==e&&(a+=r.result.team1Player1Score),r.team1.players[1]==e&&(a+=r.result.team1Player2Score),r.team2.players[0]==e&&(a+=r.result.team2Player1Score),r.team2.players[1]==e&&(a+=r.result.team2Player2Score))})}),a},w=(t,e,o)=>{let a=0,s=f(t);return o||(s=s.concat(n(t))),s.forEach(l=>{l.forEach(r=>{r.result&&(r.team1._id==e&&(a+=r.result.team2Score),r.team2._id==e&&(a+=r.result.team1Score))})}),a},D=(t,e,o)=>{let a=0,s=f(t);return o||(s=s.concat(n(t))),s.forEach(l=>{l.forEach(r=>{r.result&&(r.team1.players[0]==e&&a++,r.team1.players[1]==e&&a++,r.team2.players[0]==e&&a++,r.team2.players[1]==e&&a++)})}),a},O=(t,e,o)=>{let a=!1;return f(t).forEach(l=>{l.forEach(r=>{r.result&&r.team1._id==e&&r.team2._id==o&&(a=r.result.team1Score>r.result.Team2ID)})}),a},E=(t,e,o)=>{let a=f(t);o||(a=a.concat(n(t)));let s=0,l=0;return a.forEach(r=>{r.forEach(c=>{c.result&&(c.team1._id==e._id&&(l+=c.result.team2Score),c.team2._id==e._id&&(l+=c.result.team1Score),c.team1._id==e._id&&c.result.team1Score<c.result.team2Score&&(s+=c.result.team2Score-c.result.team1Score),c.team2._id==e._id&&c.result.team1Score>c.result.team2Score&&(s+=c.result.team1Score-c.result.team2Score))})}),s+l},F=async t=>{let e=await m.post("/getTournamentByName",{tournamentName:t});if(console.log(e.data.message),e.data.success)return e.data.tournament},k=async t=>{let e="Weck BiPo Open "+t,o=await m.post("/getTournamentByName",{tournamentName:e});if(console.log(o.data.message),o.data.success)return o.data.tournament},x=async(t,e)=>{let o=await m.post("/setSettings",{tournamentID:t,settings:e});return console.log(o.data.message),o.data.success},C=async(t,e)=>{let o=await m.post("/addTeam",{tournamentID:t,team:e});return console.log(o.data.message),o.data.success},A=async(t,e)=>{let o=await m.post("/editTeam",{tournamentID:t,team:e});return console.log(o.data.message),o.data.success},B=async(t,e)=>{let o=await m.post("/removeTeam",{tournamentID:t,teamID:e});return console.log(o.data.message),o.data.success},p=(t,e)=>t.teams.find(a=>a._id==e),W=(t,e)=>t.teams.find(a=>a.name==e),M=t=>{if(!t||!t.groupPhase.groups)return[];let e=[];return t.groupPhase.groups.forEach((o,a)=>{e.push({teams:[]}),o.teams.forEach(s=>{let l=p(t,s.teamID);e[a].teams.push(l)})}),e},G=async(t,e)=>{let o=await m.post("/setGroups",{tournamentID:t,groups:e});return console.log(o.data.message),o.data.success},K=async t=>{let e=[],o=S(t.teams),a=t.settings.fixedGroupAmmount;for(let s=0;s<a;s++)e.push({teams:[]});for(let s=0;s<o.length;s++)e[s%a].teams.push({teamID:o[s]._id});await G(t._id,e)},H=t=>{let e=[];return M(t).forEach((o,a)=>{e.push({teams:[]}),o.teams.forEach(s=>{let l=s,r=I(t,l._id,!0),c=w(t,l._id,!0);l.wins=_(t,l.name,!0),l.games=D(t,l.players[0],!0),l.score=r+" : "+c,l.scoreDifference=r-c,l.hits=r,e[a].teams.push(l)})}),e.forEach(o=>{o.teams=o.teams.sort((a,s)=>a.hits==s.hits&&a.scoreDifference==s.scoreDifference&&a.wins==s.wins?O(t,a._id,s._id):s.scoreDifference==a.scoreDifference&&a.wins==s.wins?s.hits-a.hits:a.wins==s.wins?s.scoreDifference-a.scoreDifference:s.wins-a.wins)}),e},f=t=>{if(!t||!t.groupPhase.matches)return[];let e=[];return t.groupPhase.matches.forEach((o,a)=>{e.push([]),o.forEach(s=>{e[a].push({result:s.result,team1:p(t,s.team1ID),team2:p(t,s.team2ID),_id:s._id})})}),e},P=async(t,e)=>{let o=await m.post("/setMatchesGroupPhase",{tournamentID:t,matches:e});return console.log(o.data.message),o.data.success},b=async t=>{let e=[],o=t.groupPhase.groups;for(let a=0;a<o.length;a++){let s=[],l=o[a].teams;for(let r=0;r<l.length;r++)for(let c=r+1;c<l.length;c++){let i={team1ID:l[c].teamID,team2ID:l[r].teamID};s.push(i)}e.push(S(s))}await P(t._id,e)},R=async(t,e,o)=>{let a=t.groupPhase.matches;for(let s=0;s<a.length;s++)for(let l=0;l<a[s].length;l++)e==a[s][l]._id&&(a[s][l].result=o);await P(t._id,a),await T(t)},n=t=>{if(!t||!t.koPhase.matches)return[];let e=[];return t.koPhase.matches.forEach((o,a)=>{e.push([]),o.forEach(s=>{e[a].push({placeHolderTeam1:s.placeHolderTeam1,placeHolderTeam2:s.placeHolderTeam2,result:s.result,team1:p(t,s.team1ID),team2:p(t,s.team2ID),_id:s._id})})}),e},d=async(t,e)=>{let o=await m.post("/setMatchesKOPhase",{tournamentID:t,matches:e});return console.log(o.data.message),o.data.success},z=async t=>{let e=[],o=t.settings.advancingTeamsPerGroup*t.groupPhase.groups.length,a=Math.log2(o);for(let s=0;s<a;s++){let l=o/Math.pow(2,s+1);if(e.push([]),s==0)for(let r=0;r<l;r++){let c,i;r%2==0?(c=h(r+1),i=h(r+2)):(c=h(l-r+1),i=h(l-r)),e[s].push({placeHolderTeam1:"1. Platz - Gruppe "+c,placeHolderTeam2:"2. Platz - Gruppe "+i})}else{for(let r=0;r<l;r++)e[s].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"});s==a-1&&e[s].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"})}}await d(t._id,e)},T=async t=>{let e=[],o=t.koPhase.matches,a=H(t);o.forEach((s,l)=>{if(e.push([]),l==0)for(let r=0;r<s.length;r++){let c=s[r],i,u;r%2==0?(i=r,u=r+1):(i=s.length-r,u=s.length-r-1),t.name=="Weck BiPo Open 2022"&&(r==0&&(i=2,u=0),r==1&&(i=3,u=1),r==2&&(i=0,u=3),r==3&&(i=1,u=2)),t.groupPhase.matches[i].find(g=>!g.result)||(c.team1ID=a[i].teams[0]._id),t.groupPhase.matches[u].find(g=>!g.result)||(c.team2ID=a[u].teams[1]._id),e[l].push(c)}else if(l==o.length-1){let r=s[0],c=s[1],i=o[l-1][0],u=o[l-1][1];i.result&&(r.team1ID=i.result.team1Score>i.result.team2Score?i.team1ID:i.team2ID,c.team1ID=i.result.team1Score>i.result.team2Score?i.team2ID:i.team1ID),u.result&&(r.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID,c.team2ID=u.result.team1Score>u.result.team2Score?u.team2ID:u.team1ID),e[l].push(r),e[l].push(c)}else for(let r=0;r<s.length;r++){let c=s[r],i=o[l-1][r*2],u=o[l-1][r*2+1];i.result&&(c.team1ID=i.result.team1Score>i.result.team2Score?i.team1ID:i.team2ID),u.result&&(c.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID),e[l].push(c)}}),await d(t._id,e)},L=async(t,e,o)=>{let a=t.koPhase.matches;for(let s=0;s<a.length;s++)for(let l=0;l<a[s].length;l++)e==a[s][l]._id&&(a[s][l].result=o);await d(t._id,a),await T(t)},N=t=>{let e=[],o=t.teams;for(let a=0;a<o.length;a++)for(let s=0;s<o[a].players.length;s++){let l={name:o[a].players[s],score:y(t,o[a].players[s],!1),ammountOfMatches:D(t,o[a].players[s],!1),ammountOfDrunkenCups:Math.ceil(E(t,o[a],!1)/2)};l.averageScore=(l.ammountOfMatches==0?0:l.score/l.ammountOfMatches).toFixed(2),e.push(l)}e.sort((a,s)=>s.averageScore==a.averageScore?s.ammountOfDrunkenCups-a.ammountOfDrunkenCups:s.averageScore-a.averageScore);for(let a=0;a<e.length;a++){e[a].placement=a;let s=e.filter(l=>l.averageScore==e[a].averageScore&&l.ammountOfDrunkenCups==e[a].ammountOfDrunkenCups);s.length>1&&s.forEach(l=>{l.placement=s[0].placement})}return e};export{H as a,M as b,h as c,N as d,f as e,C as f,k as g,A as h,W as i,G as j,b as k,z as l,K as m,F as n,P as o,n as p,R as q,B as r,x as s,L as t};
