import{j as u}from"./index-Dxk_ZO5M.js";const y=t=>{for(var e=t.length-1;e>0;e--){var l=Math.floor(Math.random()*(e+1)),a=t[e];t[e]=t[l],t[l]=a}return t},R=t=>t.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(e)).join(""),T=(t,e,l)=>{let a=0;return d(t,e,l).forEach(r=>{r.team1.name==e&&r.result.team1Score>r.result.team2Score&&a++,r.team2.name==e&&r.result.team2Score>r.result.team1Score&&a++}),a},w=(t,e,l)=>{let a=0;return d(t,e,l).forEach(r=>{r.team1.name==e&&(a+=r.result.team1Score),r.team2.name==e&&(a+=r.result.team2Score)}),a},O=(t,e,l)=>{let a=0;return d(t,e,l).forEach(r=>{r.team1.name==e&&(a+=r.result.team2Score),r.team2.name==e&&(a+=r.result.team1Score)}),a},k=(t,e,l)=>{let a=0,s=0;return d(t,e,l).forEach(o=>{o.team1.name==e&&(s+=o.result.team2Score),o.team2.name==e&&(s+=o.result.team1Score),o.team1.name==e&&o.result.team1Score<o.result.team2Score&&(a+=o.result.team2Score-o.result.team1Score),o.team2.name==e&&o.result.team1Score>o.result.team2Score&&(a+=o.result.team1Score-o.result.team2Score)}),a+s},G=(t,e,l)=>{if(!t.settings.trackPlayerShots)return 0;let a=0;return _(t,e,l).forEach(r=>{r.team1.players[0]==e&&(a+=r.result.team1Player1Score),r.team1.players[1]==e&&(a+=r.result.team1Player2Score),r.team2.players[0]==e&&(a+=r.result.team2Player1Score),r.team2.players[1]==e&&(a+=r.result.team2Player2Score)}),a},D=(t,e,l)=>_(t,e,l).length,v=(t,e,l)=>{let a=0;return _(t,e,l).forEach(r=>{(r.team1.players[0]==e||r.team1.players[1]==e)&&r.result.team1Score>r.result.team2Score&&a++,(r.team2.players[0]==e||r.team2.players[1]==e)&&r.result.team2Score>r.result.team1Score&&a++}),a},W=(t,e,l)=>{let a=!1;return g(t).forEach(r=>{r.forEach(o=>{o.result&&o.team1.name==e&&o.team2.name==l&&(a=o.result.team1Score>o.result.team2Score)})}),a},j=async t=>{let e=await u.post("/createTournament",t);return console.log(e.data.message),e.data.success},V=async()=>{let t=await u.get("/tournaments");if(console.log(t.data.message),t.data.success)return t.data.tournaments},q=async t=>{let e=await u.post("/getTournamentByName",{tournamentName:t});if(console.log(e.data.message),e.data.success)return e.data.tournament},z=async t=>{let e=t.replaceAll("-"," ");(t=="2020"||t=="2021"||t=="2022"||t=="2023"||t=="2024"||t=="2025"||t=="2026"||t=="2027")&&(e="Weck BiPo Open "+t);let l=await u.post("/getTournamentByName",{tournamentName:e});if(console.log(l.data.message),l.data.success)return l.data.tournament},L=async(t,e)=>{let l=await u.post("/setSettings",{tournamentID:t,settings:e});return console.log(l.data.message),l.data.success},x=t=>{if(!t)return[];let e=[],l=A(t);for(let a=0;a<l.length;a++)for(let s=0;s<l[a].players.length;s++){let r=D(t,l[a].players[s],!1),o=G(t,l[a].players[s],!1),m=v(t,l[a].players[s],!1),c={name:l[a].players[s],score:o,ammountOfMatches:r,ammountOfMatchesWithTrackedShots:t.settings.trackPlayerShots?r:0,ammountOfDrunkenCups:Math.ceil(k(t,l[a].name,!1)/2),wins:m,averageScore:Math.round((r==0?0:o/r)*100)/100,averageWins:Math.round((r==0?0:m/r)*100)/100};e.push(c)}return e},J=t=>{let e=x(t);e.sort((l,a)=>a.averageScore==l.averageScore?a.ammountOfDrunkenCups-l.ammountOfDrunkenCups:a.averageScore-l.averageScore);for(let l=0;l<e.length;l++){e[l].placement=l;let a=e.filter(s=>s.averageScore==e[l].averageScore&&s.ammountOfDrunkenCups==e[l].ammountOfDrunkenCups);a.length>1&&a.forEach(s=>{s.placement=a[0].placement})}return e},_=(t,e,l)=>{let a=[],s=g(t);return l||(s=s.concat(p(t))),s.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.players[0]==e||o.team1.players[1]==e||o.team2.players[0]==e||o.team2.players[1]==e)&&a.push({_id:o._id,team1:o.team1,team2:o.team2,result:o.result})})}),a},Q=async(t,e)=>{let l=await u.post("/addTeam",{tournamentID:t,team:e});return console.log(l.data.message),l.data.success},U=async(t,e)=>{let l=await u.post("/editTeam",{tournamentID:t,team:e});return console.log(l.data.message),l.data.success},X=async(t,e)=>{let l=await u.post("/removeTeam",{tournamentID:t,teamID:e});return console.log(l.data.message),l.data.success},h=(t,e)=>t.teams.find(a=>a._id==e),Y=(t,e)=>t.teams.find(a=>a.name==e),A=t=>{if(!t)return[];let e=[];return t.teams.forEach(l=>{e.push(l)}),e},K=t=>{if(!t)return[];let e=p(t);for(let a=0;a<e.length;a++)for(let s=0;s<e[a].length;s++)if(!e[a][s].result)return[];let l=[];if(e.length>0){let a=e[e.length-1][0],s=a.result.team1Score>a.result.team2Score?a.team1:a.team2,r=a.result.team1Score>a.result.team2Score?a.team2:a.team1,o=e[e.length-1][1],m=o.result.team1Score>o.result.team2Score?o.team1:o.team2,c=o.result.team1Score>o.result.team2Score?o.team2:o.team1;l.push(s),l.push(r),l.push(m),l.push(c)}return l},d=(t,e,l)=>{let a=[],s=g(t);return l||(s=s.concat(p(t))),s.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.name==e||o.team2.name==e)&&a.push({_id:o._id,team1:o.team1,team2:o.team2,result:o.result})})}),a},Z=t=>{let e=[],l=B(t);for(let a=0;a<l.length;a++){let s=w(t,l[a].name,!1),r=O(t,l[a].name,!1),o={name:l[a].name,players:l[a].players,wins:T(t,l[a].name,!1),games:D(t,l[a].players[0],!1),score:s+" : "+r,scoreDifference:s-r,hits:s};e.push(o)}e=e.sort((a,s)=>a.games==s.games?s.wins-a.wins:s.games-a.games);for(let a=0;a<e.length;a++){e[a].placement=a;let s=K(t),r=s.map(o=>o.name).includes(e[a].name);if(!r){let o=e.filter(m=>m.games==e[a].games);o.length>1&&o.forEach(m=>{m.placement=o[0].placement})}r&&(e[a].placement=s.map(o=>o.name).indexOf(e[a].name))}return e=e.sort((a,s)=>a.placement-s.placement),e},S=t=>{if(!t||!t.groupPhase.groups)return[];let e=[];return t.groupPhase.groups.forEach((l,a)=>{let s=[];e.push({teams:s}),l.teams.forEach(r=>{let o=h(t,r.teamID);e[a].teams.push(o)})}),e},C=async(t,e)=>{let l=await u.post("/setGroups",{tournamentID:t,groups:e});return console.log(l.data.message),l.data.success},$=async t=>{let e=[],l=y(t.teams),a=t.settings.fixedGroupAmmount;for(let s=0;s<a;s++)e.push({teams:[]});for(let s=0;s<l.length;s++)e[s%a].teams.push({teamID:l[s]._id});await C(t._id,e)},H=t=>{let e=[],l=S(t);for(let a=0;a<l.length;a++){e.push({teams:[]});for(let s=0;s<l[a].teams.length;s++){let r=w(t,l[a].teams[s].name,!0),o=O(t,l[a].teams[s].name,!0),m={name:l[a].teams[s].name,players:l[a].teams[s].players,wins:T(t,l[a].teams[s].name,!0),games:D(t,l[a].teams[s].players[0],!0),score:r+" : "+o,scoreDifference:r-o,hits:r};e[a].teams.push(m)}}return e.forEach(a=>{a.teams=a.teams.sort((s,r)=>s.hits==r.hits&&s.scoreDifference==r.scoreDifference&&s.wins==r.wins?W(t,s.name,r.name)?1:-1:r.scoreDifference==s.scoreDifference&&s.wins==r.wins?r.hits-s.hits:s.wins==r.wins?r.scoreDifference-s.scoreDifference:r.wins-s.wins)}),e},g=t=>{if(!t||!t.groupPhase.matches)return[];let e=[];return t.groupPhase.matches.forEach((l,a)=>{e.push([]),l.forEach(s=>{e[a].push({result:s.result,team1:h(t,s.team1ID),team2:h(t,s.team2ID),_id:s._id})})}),e},E=async(t,e)=>{let l=await u.post("/setMatchesGroupPhase",{tournamentID:t,matches:e});return console.log(l.data.message),l.data.success},N=async t=>{let e=[],l=S(t);for(let a=0;a<l.length;a++){let s=[],r=l[a].teams,o=r.length*(r.length-1)/2;if(o==10)s.push({team1ID:r[0]._id,team2ID:r[1]._id,_id:""}),s.push({team1ID:r[2]._id,team2ID:r[3]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[4]._id,_id:""}),s.push({team1ID:r[1]._id,team2ID:r[3]._id,_id:""}),s.push({team1ID:r[2]._id,team2ID:r[4]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[3]._id,_id:""}),s.push({team1ID:r[1]._id,team2ID:r[2]._id,_id:""}),s.push({team1ID:r[3]._id,team2ID:r[4]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[2]._id,_id:""}),s.push({team1ID:r[1]._id,team2ID:r[4]._id,_id:""});else if(o==6)s.push({team1ID:r[2]._id,team2ID:r[3]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[1]._id,_id:""}),s.push({team1ID:r[2]._id,team2ID:r[1]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[3]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[2]._id,_id:""}),s.push({team1ID:r[1]._id,team2ID:r[3]._id,_id:""});else if(o==3)s.push({team1ID:r[0]._id,team2ID:r[1]._id,_id:""}),s.push({team1ID:r[0]._id,team2ID:r[2]._id,_id:""}),s.push({team1ID:r[1]._id,team2ID:r[2]._id,_id:""});else{for(let m=0;m<r.length;m++)for(let c=m+1;c<r.length;c++){let i={team1ID:r[c]._id,team2ID:r[m]._id,_id:""};s.push(i)}s=y(s)}e.push(s)}await E(t._id,e)},ee=async(t,e,l)=>{let a=t.groupPhase.matches;for(let s=0;s<a.length;s++)for(let r=0;r<a[s].length;r++)e==a[s][r]._id&&(a[s][r].result=l);await E(t._id,a),await M(t)},B=t=>{if(!t||!t.koPhase.matches)return[];let e=[];return p(t).forEach(a=>{a.forEach(s=>{s.team1&&!e.includes(s.team1)&&e.push(s.team1),s.team2&&!e.includes(s.team2)&&e.push(s.team2)})}),e},p=t=>{if(!t||!t.koPhase.matches)return[];let e=[];return t.koPhase.matches.forEach((l,a)=>{e.push([]),l.forEach(s=>{e[a].push({result:s.result,team1:h(t,s.team1ID),team2:h(t,s.team2ID),_id:s._id})})}),e},I=async(t,e)=>{let l=await u.post("/setMatchesKOPhase",{tournamentID:t,matches:e});return console.log(l.data.message),l.data.success},te=async t=>{let e=[],l=t.settings.advancingTeamsPerGroup*t.groupPhase.groups.length;if(Math.log2(l)%1!=0){let s=1;for(;s<l;)s*=2;l=s}let a=Math.log2(l);for(let s=0;s<a;s++){let r=l/Math.pow(2,s+1);e.push([]);for(let o=0;o<r;o++){let m={_id:""};e[s].push(m)}s==a-1&&e[s].push({_id:""})}await I(t._id,e)},M=async t=>{let e=[],l=t.koPhase.matches,a=S(t),s=H(t);l.forEach((r,o)=>{if(e.push([]),o==0)for(let m=0;m<r.length;m++){let c=r[m],i,n,P=0,F=0;m%2==0?(i=m,n=m+1):(i=r.length-m,n=r.length-m-1),t.name=="SCW 3 Karneval 2025"&&(m==0&&(i=2,n=1),m==1&&(P=1,i=1,n=0)),t.name=="Weck BiPo Open 2022"&&(m==0&&(i=2,n=0),m==1&&(i=3,n=1),m==2&&(i=0,n=3),m==3&&(i=1,n=2)),t.groupPhase.matches[i].find(f=>!f.result)||(c.team1ID=a[i].teams.find(f=>f.name==s[i].teams[P].name)._id),t.groupPhase.matches[n].find(f=>!f.result)||(c.team2ID=a[n].teams.find(f=>f.name==s[n].teams[F].name)._id),e[o].push(c)}else if(o==l.length-1){let m=r[0],c=r[1],i=l[o-1][0],n=l[o-1][1];i.result&&(m.team1ID=i.result.team1Score>i.result.team2Score?i.team1ID:i.team2ID,c.team1ID=i.result.team1Score>i.result.team2Score?i.team2ID:i.team1ID),n.result&&(m.team2ID=n.result.team1Score>n.result.team2Score?n.team1ID:n.team2ID,c.team2ID=n.result.team1Score>n.result.team2Score?n.team2ID:n.team1ID),e[o].push(m),e[o].push(c)}else for(let m=0;m<r.length;m++){let c=r[m],i=l[o-1][m*2],n=l[o-1][m*2+1];i.result&&(c.team1ID=i.result.team1Score>i.result.team2Score?i.team1ID:i.team2ID),n.result&&(c.team2ID=n.result.team1Score>n.result.team2Score?n.team1ID:n.team2ID),e[o].push(c)}}),await I(t._id,e)},se=async(t,e,l)=>{let a=t.koPhase.matches;for(let s=0;s<a.length;s++)for(let r=0;r<a[s].length;r++)e==a[s][r]._id&&(a[s][r].result=l);await I(t._id,a),await M(t)},ae=t=>{let e=!0,l=g(t);return l=l.concat(p(t)),l.forEach(a=>{a.forEach(s=>{s.result||(e=!1)})}),e};export{ee as A,se as B,x as a,H as b,R as c,ae as d,Z as e,J as f,z as g,g as h,A as i,K as j,p as k,k as l,V as m,j as n,Q as o,U as p,S as q,X as r,L as s,Y as t,C as u,$ as v,N as w,te as x,q as y,E as z};
