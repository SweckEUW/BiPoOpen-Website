import{z as n}from"./index-218c6b24.js";const T=s=>{for(var e=s.length-1;e>0;e--){var l=Math.floor(Math.random()*(e+1)),r=s[e];s[e]=s[l],s[l]=r}return s},f=s=>s.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(e)).join(""),O=(s,e,l)=>{let r=0;return h(s,e,l).forEach(a=>{a.team1.name==e&&a.result.team1Score>a.result.team2Score&&r++,a.team2.name==e&&a.result.team2Score>a.result.team1Score&&r++}),r},y=(s,e,l)=>{let r=0;return h(s,e,l).forEach(a=>{a.team1.name==e&&(r+=a.result.team1Score),a.team2.name==e&&(r+=a.result.team2Score)}),r},w=(s,e,l)=>{let r=0;return h(s,e,l).forEach(a=>{a.team1.name==e&&(r+=a.result.team2Score),a.team2.name==e&&(r+=a.result.team1Score)}),r},F=(s,e,l)=>{let r=0,t=0;return h(s,e,l).forEach(o=>{o.team1.name==e&&(t+=o.result.team2Score),o.team2.name==e&&(t+=o.result.team1Score),o.team1.name==e&&o.result.team1Score<o.result.team2Score&&(r+=o.result.team2Score-o.result.team1Score),o.team2.name==e&&o.result.team1Score>o.result.team2Score&&(r+=o.result.team1Score-o.result.team2Score)}),r+t},G=(s,e,l)=>{let r=0;return D(s,e,l).forEach(a=>{a.team1.players[0]==e&&(r+=a.result.team1Player1Score),a.team1.players[1]==e&&(r+=a.result.team1Player2Score),a.team2.players[0]==e&&(r+=a.result.team2Player1Score),a.team2.players[1]==e&&(r+=a.result.team2Player2Score)}),r},g=(s,e,l)=>D(s,e,l).length,_=(s,e,l)=>{let r=0;return D(s,e,l).forEach(a=>{(a.team1.players[0]==e||a.team1.players[1]==e)&&a.result.team1Score>a.result.team2Score&&r++,(a.team2.players[0]==e||a.team2.players[1]==e)&&a.result.team2Score>a.result.team1Score&&r++}),r},H=(s,e,l)=>{let r=!1;return I(s).forEach(a=>{a.forEach(o=>{o.result&&o.team1._id==e&&o.team2._id==l&&(r=o.result.team1Score>o.result.Team2ID)})}),r},C=async s=>{let e=await n.post("/getTournamentByName",{tournamentName:s});if(console.log(e.data.message),e.data.success)return e.data.tournament},B=async s=>{let e="Weck BiPo Open "+s;s.includes("Kirmes")&&(e=s);let l=await n.post("/getTournamentByName",{tournamentName:e});if(console.log(l.data.message),l.data.success)return l.data.tournament},b=async(s,e)=>{let l=await n.post("/setSettings",{tournamentID:s,settings:e});return console.log(l.data.message),l.data.success},v=s=>{if(!s)return[];let e=[],l=k(s);for(let r=0;r<l.length;r++)for(let t=0;t<l[r].players.length;t++){let a={name:l[r].players[t],score:G(s,l[r].players[t],!1),ammountOfMatches:g(s,l[r].players[t],!1),ammountOfDrunkenCups:Math.ceil(F(s,l[r].name,!1)/2),wins:_(s,l[r].players[t],!1)};a.averageScore=(a.ammountOfMatches==0?0:a.score/a.ammountOfMatches).toFixed(2),a.averageWins=(a.ammountOfMatches==0?0:a.wins/a.ammountOfMatches).toFixed(2),e.push(a)}return e},R=s=>{let e=v(s);e.sort((l,r)=>r.averageScore==l.averageScore?r.ammountOfDrunkenCups-l.ammountOfDrunkenCups:r.averageScore-l.averageScore);for(let l=0;l<e.length;l++){e[l].placement=l;let r=e.filter(t=>t.averageScore==e[l].averageScore&&t.ammountOfDrunkenCups==e[l].ammountOfDrunkenCups);r.length>1&&r.forEach(t=>{t.placement=r[0].placement})}return e},D=(s,e,l)=>{let r=[],t=I(s);return l||(t=t.concat(S(s))),t.forEach(a=>{a.forEach(o=>{o.result&&(o.team1.players[0]==e||o.team1.players[1]==e||o.team2.players[0]==e||o.team2.players[1]==e)&&r.push(o)})}),r},z=async(s,e)=>{let l=await n.post("/addTeam",{tournamentID:s,team:e});return console.log(l.data.message),l.data.success},L=async(s,e)=>{let l=await n.post("/editTeam",{tournamentID:s,team:e});return console.log(l.data.message),l.data.success},V=async(s,e)=>{let l=await n.post("/removeTeam",{tournamentID:s,teamID:e});return console.log(l.data.message),l.data.success},i=(s,e)=>s.teams.find(r=>r._id==e),j=(s,e)=>s.teams.find(r=>r.name==e),k=s=>{if(!s)return[];let e=[];return s.teams.forEach(l=>{e.push(l)}),e},x=s=>{if(!s)return[];let e=[],l=S(s);if(l.length>0){let r=l[l.length-1][0],t=r.result.team1Score>r.result.team2Score?r.team1:r.team2,a=r.result.team1Score>r.result.team2Score?r.team2:r.team1,o=l[l.length-1][1],c=o.result.team1Score>o.result.team2Score?o.team1:o.team2,m=o.result.team1Score>o.result.team2Score?o.team2:o.team1;e.push(t),e.push(a),e.push(c),e.push(m)}return e},h=(s,e,l)=>{let r=[],t=I(s);return l||(t=t.concat(S(s))),t.forEach(a=>{a.forEach(o=>{o.result&&(o.team1.name==e||o.team2.name==e)&&r.push(o)})}),r},q=s=>{let e=[];K(s).forEach(r=>{let t=r,a=y(s,t.name,!1),o=w(s,t.name,!1);t.wins=O(s,t.name,!1),t.games=g(s,t.players[0],!1),t.score=a+" : "+o,t.scoreDifference=a-o,t.hits=a,e.push(t)}),e=e.sort((r,t)=>r.games==t.games?t.wins-r.wins:t.games-r.games);for(let r=0;r<e.length;r++){e[r].placement=r;let t=x(s);if(!t.includes(e[r])){let a=e.filter(o=>o.games==e[r].games);a.length>1&&a.forEach(o=>{o.placement=a[0].placement})}t.includes(e[r])&&(e[r].placement=t.indexOf(e[r]))}return e=e.sort((r,t)=>r.placement-t.placement),e},d=s=>{if(!s||!s.groupPhase.groups)return[];let e=[];return s.groupPhase.groups.forEach((l,r)=>{e.push({teams:[]}),l.teams.forEach(t=>{let a=i(s,t.teamID);e[r].teams.push(a)})}),e},W=async(s,e)=>{let l=await n.post("/setGroups",{tournamentID:s,groups:e});return console.log(l.data.message),l.data.success},J=async s=>{let e=[],l=T(s.teams),r=s.settings.fixedGroupAmmount;for(let t=0;t<r;t++)e.push({teams:[]});for(let t=0;t<l.length;t++)e[t%r].teams.push({teamID:l[t]._id});await W(s._id,e)},Q=s=>{if(!s)return[];let e=[];return d(s).forEach((r,t)=>{e.push({teams:[]}),r.teams.forEach(a=>{let o=a,c=y(s,o.name,!0),m=w(s,o.name,!0);o.wins=O(s,o.name,!0),o.games=g(s,o.players[0],!0),o.score=c+" : "+m,o.scoreDifference=c-m,o.hits=c,e[t].teams.push(o)})}),e.forEach(r=>{r.teams=r.teams.sort((t,a)=>t.hits==a.hits&&t.scoreDifference==a.scoreDifference&&t.wins==a.wins?H(s,t._id,a._id):a.scoreDifference==t.scoreDifference&&t.wins==a.wins?a.hits-t.hits:t.wins==a.wins?a.scoreDifference-t.scoreDifference:a.wins-t.wins)}),e},I=s=>{if(!s||!s.groupPhase.matches)return[];let e=[];return s.groupPhase.matches.forEach((l,r)=>{e.push([]),l.forEach(t=>{e[r].push({result:t.result,team1:i(s,t.team1ID),team2:i(s,t.team2ID),_id:t._id})})}),e},M=async(s,e)=>{let l=await n.post("/setMatchesGroupPhase",{tournamentID:s,matches:e});return console.log(l.data.message),l.data.success},U=async s=>{let e=[],l=d(s);for(let r=0;r<l.length;r++){let t=[],a=l[r].teams,o=a.length*(a.length-1)/2;if(o==6)t.push({team1ID:a[2].teamID,team2ID:a[3].teamID}),t.push({team1ID:a[0].teamID,team2ID:a[1].teamID}),t.push({team1ID:a[2].teamID,team2ID:a[1].teamID}),t.push({team1ID:a[0].teamID,team2ID:a[3].teamID}),t.push({team1ID:a[0].teamID,team2ID:a[2].teamID}),t.push({team1ID:a[1].teamID,team2ID:a[3].teamID}),e.push(t);else if(o==3)t.push({team1ID:a[0].teamID,team2ID:a[1].teamID}),t.push({team1ID:a[0].teamID,team2ID:a[2].teamID}),t.push({team1ID:a[1].teamID,team2ID:a[2].teamID}),e.push(t);else{for(let c=0;c<a.length;c++)for(let m=c+1;m<a.length;m++){let u={team1ID:a[m].teamID,team2ID:a[c].teamID};t.push(u)}t=T(t),e.push(t)}}await M(s._id,e)},X=async(s,e,l)=>{let r=s.groupPhase.matches;for(let t=0;t<r.length;t++)for(let a=0;a<r[t].length;a++)e==r[t][a]._id&&(r[t][a].result=l);await M(s._id,r),await E(s)},K=s=>{if(!s||!s.koPhase.matches)return[];let e=[];return s.koPhase.matches.forEach((l,r)=>{l.forEach(t=>{let a=i(s,t.team1ID);e.includes(a)||e.push(a);let o=i(s,t.team2ID);e.includes(o)||e.push(o)})}),e},S=s=>{if(!s||!s.koPhase.matches)return[];let e=[];return s.koPhase.matches.forEach((l,r)=>{e.push([]),l.forEach(t=>{e[r].push({placeHolderTeam1:t.placeHolderTeam1,placeHolderTeam2:t.placeHolderTeam2,result:t.result,team1:i(s,t.team1ID),team2:i(s,t.team2ID),_id:t._id})})}),e},P=async(s,e)=>{let l=await n.post("/setMatchesKOPhase",{tournamentID:s,matches:e});return console.log(l.data.message),l.data.success},Y=async s=>{let e=[],l=s.settings.advancingTeamsPerGroup*s.groupPhase.groups.length,r=Math.log2(l);for(let t=0;t<r;t++){let a=l/Math.pow(2,t+1);if(e.push([]),t==0)for(let o=0;o<a;o++){let c,m;o%2==0?(c=f(o+1),m=f(o+2)):(c=f(a-o+1),m=f(a-o)),e[t].push({placeHolderTeam1:"1. Platz - Gruppe "+c,placeHolderTeam2:"2. Platz - Gruppe "+m})}else{for(let o=0;o<a;o++)e[t].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"});t==r-1&&e[t].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"})}}await P(s._id,e)},E=async s=>{let e=[],l=s.koPhase.matches,r=d(s);l.forEach((t,a)=>{if(e.push([]),a==0)for(let o=0;o<t.length;o++){let c=t[o],m,u;o%2==0?(m=o,u=o+1):(m=t.length-o,u=t.length-o-1),s.name=="Weck BiPo Open 2022"&&(o==0&&(m=2,u=0),o==1&&(m=3,u=1),o==2&&(m=0,u=3),o==3&&(m=1,u=2)),s.groupPhase.matches[m].find(p=>!p.result)||(c.team1ID=r[m].teams[0]._id),s.groupPhase.matches[u].find(p=>!p.result)||(c.team2ID=r[u].teams[1]._id),e[a].push(c)}else if(a==l.length-1){let o=t[0],c=t[1],m=l[a-1][0],u=l[a-1][1];m.result&&(o.team1ID=m.result.team1Score>m.result.team2Score?m.team1ID:m.team2ID,c.team1ID=m.result.team1Score>m.result.team2Score?m.team2ID:m.team1ID),u.result&&(o.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID,c.team2ID=u.result.team1Score>u.result.team2Score?u.team2ID:u.team1ID),e[a].push(o),e[a].push(c)}else for(let o=0;o<t.length;o++){let c=t[o],m=l[a-1][o*2],u=l[a-1][o*2+1];m.result&&(c.team1ID=m.result.team1Score>m.result.team2Score?m.team1ID:m.team2ID),u.result&&(c.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID),e[a].push(c)}}),await P(s._id,e)},Z=async(s,e,l)=>{let r=s.koPhase.matches;for(let t=0;t<r.length;t++)for(let a=0;a<r[t].length;a++)e==r[t][a]._id&&(r[t][a].result=l);await P(s._id,r),await E(s)};export{v as a,Q as b,f as c,q as d,R as e,I as f,B as g,k as h,x as i,S as j,F as k,z as l,L as m,d as n,j as o,W as p,U as q,V as r,b as s,Y as t,J as u,C as v,M as w,X as x,Z as y};
