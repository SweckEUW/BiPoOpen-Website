import{A as i}from"./index-Dp7FaSEG.js";const P=a=>{for(var e=a.length-1;e>0;e--){var l=Math.floor(Math.random()*(e+1)),r=a[e];a[e]=a[l],a[l]=r}return a},h=a=>a.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(e)).join(""),_=(a,e,l)=>{let r=0;return p(a,e,l).forEach(s=>{s.team1.name==e&&s.result.team1Score>s.result.team2Score&&r++,s.team2.name==e&&s.result.team2Score>s.result.team1Score&&r++}),r},T=(a,e,l)=>{let r=0;return p(a,e,l).forEach(s=>{s.team1.name==e&&(r+=s.result.team1Score),s.team2.name==e&&(r+=s.result.team2Score)}),r},O=(a,e,l)=>{let r=0;return p(a,e,l).forEach(s=>{s.team1.name==e&&(r+=s.result.team2Score),s.team2.name==e&&(r+=s.result.team1Score)}),r},M=(a,e,l)=>{let r=0,t=0;return p(a,e,l).forEach(o=>{o.team1.name==e&&(t+=o.result.team2Score),o.team2.name==e&&(t+=o.result.team1Score),o.team1.name==e&&o.result.team1Score<o.result.team2Score&&(r+=o.result.team2Score-o.result.team1Score),o.team2.name==e&&o.result.team1Score>o.result.team2Score&&(r+=o.result.team1Score-o.result.team2Score)}),r+t},F=(a,e,l)=>{let r=0;return I(a,e,l).forEach(s=>{s.team1.players[0]==e&&(r+=s.result.team1Player1Score),s.team1.players[1]==e&&(r+=s.result.team1Player2Score),s.team2.players[0]==e&&(r+=s.result.team2Player1Score),s.team2.players[1]==e&&(r+=s.result.team2Player2Score)}),isNaN(r)&&(r=0),r},D=(a,e,l)=>I(a,e,l).length,G=(a,e,l)=>{let r=0;return I(a,e,l).forEach(s=>{(s.team1.players[0]==e||s.team1.players[1]==e)&&s.result.team1Score>s.result.team2Score&&r++,(s.team2.players[0]==e||s.team2.players[1]==e)&&s.result.team2Score>s.result.team1Score&&r++}),r},H=(a,e,l)=>{let r=!1;return g(a).forEach(s=>{s.forEach(o=>{o.result&&o.team1._id==e&&o.team2._id==l&&(r=o.result.team1Score>o.result.Team2ID)})}),r},B=async a=>{let e=await i.post("/getTournamentByName",{tournamentName:a});if(console.log(e.data.message),e.data.success)return e.data.tournament},b=async a=>{let e=a.replaceAll("-"," ");(a=="2020"||a=="2021"||a=="2022"||a=="2023"||a=="2024"||a=="2025"||a=="2026"||a=="2027")&&(e="Weck BiPo Open "+a);let l=await i.post("/getTournamentByName",{tournamentName:e});if(console.log(l.data.message),l.data.success)return l.data.tournament},R=async(a,e)=>{let l=await i.post("/setSettings",{tournamentID:a,settings:e});return console.log(l.data.message),l.data.success},v=a=>{if(!a)return[];let e=[],l=k(a);for(let r=0;r<l.length;r++)for(let t=0;t<l[r].players.length;t++){let s={name:l[r].players[t],score:F(a,l[r].players[t],!1),ammountOfMatches:D(a,l[r].players[t],!1),ammountOfDrunkenCups:Math.ceil(M(a,l[r].name,!1)/2),wins:G(a,l[r].players[t],!1)};s.averageScore=(s.ammountOfMatches==0?0:s.score/s.ammountOfMatches).toFixed(2),s.averageWins=(s.ammountOfMatches==0?0:s.wins/s.ammountOfMatches).toFixed(2),e.push(s)}return e},z=a=>{let e=v(a);e.sort((l,r)=>r.averageScore==l.averageScore?r.ammountOfDrunkenCups-l.ammountOfDrunkenCups:r.averageScore-l.averageScore);for(let l=0;l<e.length;l++){e[l].placement=l;let r=e.filter(t=>t.averageScore==e[l].averageScore&&t.ammountOfDrunkenCups==e[l].ammountOfDrunkenCups);r.length>1&&r.forEach(t=>{t.placement=r[0].placement})}return e},I=(a,e,l)=>{let r=[],t=g(a);return l||(t=t.concat(f(a))),t.forEach(s=>{s.forEach(o=>{o.result&&(o.team1.players[0]==e||o.team1.players[1]==e||o.team2.players[0]==e||o.team2.players[1]==e)&&r.push(o)})}),r},L=async(a,e)=>{let l=await i.post("/addTeam",{tournamentID:a,team:e});return console.log(l.data.message),l.data.success},V=async(a,e)=>{let l=await i.post("/editTeam",{tournamentID:a,team:e});return console.log(l.data.message),l.data.success},j=async(a,e)=>{let l=await i.post("/removeTeam",{tournamentID:a,teamID:e});return console.log(l.data.message),l.data.success},n=(a,e)=>a.teams.find(r=>r._id==e),q=(a,e)=>a.teams.find(r=>r.name==e),k=a=>{if(!a)return[];let e=[];return a.teams.forEach(l=>{e.push(l)}),e},x=a=>{if(!a)return[];let e=f(a);for(let r=0;r<e.length;r++)for(let t=0;t<e[r].length;t++)if(!e[r][t].result)return[];let l=[];if(e.length>0){let r=e[e.length-1][0],t=r.result.team1Score>r.result.team2Score?r.team1:r.team2,s=r.result.team1Score>r.result.team2Score?r.team2:r.team1,o=e[e.length-1][1],c=o.result.team1Score>o.result.team2Score?o.team1:o.team2,m=o.result.team1Score>o.result.team2Score?o.team2:o.team1;l.push(t),l.push(s),l.push(c),l.push(m)}return l},p=(a,e,l)=>{let r=[],t=g(a);return l||(t=t.concat(f(a))),t.forEach(s=>{s.forEach(o=>{o.result&&(o.team1.name==e||o.team2.name==e)&&r.push(o)})}),r},J=a=>{let e=[];K(a).forEach(r=>{let t=r,s=T(a,t.name,!1),o=O(a,t.name,!1);t.wins=_(a,t.name,!1),t.games=D(a,t.players[0],!1),t.score=s+" : "+o,t.scoreDifference=s-o,t.hits=s,e.push(t)}),e=e.sort((r,t)=>r.games==t.games?t.wins-r.wins:t.games-r.games);for(let r=0;r<e.length;r++){e[r].placement=r;let t=x(a);if(!t.includes(e[r])){let s=e.filter(o=>o.games==e[r].games);s.length>1&&s.forEach(o=>{o.placement=s[0].placement})}t.includes(e[r])&&(e[r].placement=t.indexOf(e[r]))}return e=e.sort((r,t)=>r.placement-t.placement),e},y=a=>{if(!a||!a.groupPhase.groups)return[];let e=[];return a.groupPhase.groups.forEach((l,r)=>{e.push({teams:[]}),l.teams.forEach(t=>{let s=n(a,t.teamID);e[r].teams.push(s)})}),e},W=async(a,e)=>{let l=await i.post("/setGroups",{tournamentID:a,groups:e});return console.log(l.data.message),l.data.success},Q=async a=>{let e=[],l=P(a.teams),r=a.settings.fixedGroupAmmount;for(let t=0;t<r;t++)e.push({teams:[]});for(let t=0;t<l.length;t++)e[t%r].teams.push({teamID:l[t]._id});await W(a._id,e)},A=a=>{if(!a)return[];let e=[];return y(a).forEach((r,t)=>{e.push({teams:[]}),r.teams.forEach(s=>{let o=s,c=T(a,o.name,!0),m=O(a,o.name,!0);o.wins=_(a,o.name,!0),o.games=D(a,o.players[0],!0),o.score=c+" : "+m,o.scoreDifference=c-m,o.hits=c,e[t].teams.push(o)})}),e.forEach(r=>{r.teams=r.teams.sort((t,s)=>t.hits==s.hits&&t.scoreDifference==s.scoreDifference&&t.wins==s.wins?H(a,t._id,s._id):s.scoreDifference==t.scoreDifference&&t.wins==s.wins?s.hits-t.hits:t.wins==s.wins?s.scoreDifference-t.scoreDifference:s.wins-t.wins)}),e},g=a=>{if(!a||!a.groupPhase.matches)return[];let e=[];return a.groupPhase.matches.forEach((l,r)=>{e.push([]),l.forEach(t=>{e[r].push({result:t.result,team1:n(a,t.team1ID),team2:n(a,t.team2ID),_id:t._id})})}),e},w=async(a,e)=>{let l=await i.post("/setMatchesGroupPhase",{tournamentID:a,matches:e});return console.log(l.data.message),l.data.success},U=async a=>{let e=[],l=y(a);for(let r=0;r<l.length;r++){let t=[],s=l[r].teams,o=s.length*(s.length-1)/2;if(o==10)t.push({team1ID:s[0]._id,team2ID:s[1]._id}),t.push({team1ID:s[2]._id,team2ID:s[3]._id}),t.push({team1ID:s[0]._id,team2ID:s[4]._id}),t.push({team1ID:s[1]._id,team2ID:s[3]._id}),t.push({team1ID:s[2]._id,team2ID:s[4]._id}),t.push({team1ID:s[0]._id,team2ID:s[3]._id}),t.push({team1ID:s[1]._id,team2ID:s[2]._id}),t.push({team1ID:s[3]._id,team2ID:s[4]._id}),t.push({team1ID:s[0]._id,team2ID:s[2]._id}),t.push({team1ID:s[1]._id,team2ID:s[4]._id});else if(o==6)t.push({team1ID:s[2]._id,team2ID:s[3]._id}),t.push({team1ID:s[0]._id,team2ID:s[1]._id}),t.push({team1ID:s[2]._id,team2ID:s[1]._id}),t.push({team1ID:s[0]._id,team2ID:s[3]._id}),t.push({team1ID:s[0]._id,team2ID:s[2]._id}),t.push({team1ID:s[1]._id,team2ID:s[3]._id});else if(o==3)t.push({team1ID:s[0]._id,team2ID:s[1]._id}),t.push({team1ID:s[0]._id,team2ID:s[2]._id}),t.push({team1ID:s[1]._id,team2ID:s[2]._id});else{for(let c=0;c<s.length;c++)for(let m=c+1;m<s.length;m++){let u={team1ID:s[m]._id,team2ID:s[c]._id};t.push(u)}t=P(t)}e.push(t)}await w(a._id,e)},X=async(a,e,l)=>{let r=a.groupPhase.matches;for(let t=0;t<r.length;t++)for(let s=0;s<r[t].length;s++)e==r[t][s]._id&&(r[t][s].result=l);await w(a._id,r),await E(a)},K=a=>{if(!a||!a.koPhase.matches)return[];let e=[];return f(a).forEach(r=>{r.forEach(t=>{t.team1&&!e.includes(t.team1)&&e.push(t.team1),t.team2&&!e.includes(t.team2)&&e.push(t.team2)})}),e},f=a=>{if(!a||!a.koPhase.matches)return[];let e=[];return a.koPhase.matches.forEach((l,r)=>{e.push([]),l.forEach(t=>{e[r].push({placeHolderTeam1:t.placeHolderTeam1,placeHolderTeam2:t.placeHolderTeam2,result:t.result,team1:n(a,t.team1ID),team2:n(a,t.team2ID),_id:t._id})})}),e},S=async(a,e)=>{let l=await i.post("/setMatchesKOPhase",{tournamentID:a,matches:e});return console.log(l.data.message),l.data.success},Y=async a=>{let e=[],l=a.settings.advancingTeamsPerGroup*a.groupPhase.groups.length,r=Math.log2(l);for(let t=0;t<r;t++){let s=l/Math.pow(2,t+1);if(e.push([]),t==0)for(let o=0;o<s;o++){let c,m;o%2==0?(c=h(o+1),m=h(o+2)):(c=h(s-o+1),m=h(s-o)),e[t].push({placeHolderTeam1:"1. Platz - Gruppe "+c,placeHolderTeam2:"2. Platz - Gruppe "+m})}else{for(let o=0;o<s;o++)e[t].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"});t==r-1&&e[t].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"})}}await S(a._id,e)},E=async a=>{let e=[],l=a.koPhase.matches,r=A(a);l.forEach((t,s)=>{if(e.push([]),s==0)for(let o=0;o<t.length;o++){let c=t[o],m,u;o%2==0?(m=o,u=o+1):(m=t.length-o,u=t.length-o-1),a.name=="Weck BiPo Open 2022"&&(o==0&&(m=2,u=0),o==1&&(m=3,u=1),o==2&&(m=0,u=3),o==3&&(m=1,u=2)),a.groupPhase.matches[m].find(d=>!d.result)||(c.team1ID=r[m].teams[0]._id),a.groupPhase.matches[u].find(d=>!d.result)||(c.team2ID=r[u].teams[1]._id),e[s].push(c)}else if(s==l.length-1){let o=t[0],c=t[1],m=l[s-1][0],u=l[s-1][1];m.result&&(o.team1ID=m.result.team1Score>m.result.team2Score?m.team1ID:m.team2ID,c.team1ID=m.result.team1Score>m.result.team2Score?m.team2ID:m.team1ID),u.result&&(o.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID,c.team2ID=u.result.team1Score>u.result.team2Score?u.team2ID:u.team1ID),e[s].push(o),e[s].push(c)}else for(let o=0;o<t.length;o++){let c=t[o],m=l[s-1][o*2],u=l[s-1][o*2+1];m.result&&(c.team1ID=m.result.team1Score>m.result.team2Score?m.team1ID:m.team2ID),u.result&&(c.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID),e[s].push(c)}}),await S(a._id,e)},Z=async(a,e,l)=>{let r=a.koPhase.matches;for(let t=0;t<r.length;t++)for(let s=0;s<r[t].length;s++)e==r[t][s]._id&&(r[t][s].result=l);await S(a._id,r),await E(a)},$=a=>{let e=!0,l=g(a);return l=l.concat(f(a)),l.forEach(r=>{r.forEach(t=>{t.result||(e=!1)})}),e};export{v as a,A as b,h as c,$ as d,J as e,z as f,b as g,g as h,k as i,x as j,f as k,M as l,L as m,V as n,y as o,q as p,W as q,j as r,R as s,U as t,Y as u,Q as v,B as w,w as x,X as y,Z as z};
