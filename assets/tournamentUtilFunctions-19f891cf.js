import{z as i}from"./index-1197ba8f.js";const S=s=>{for(var t=s.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1)),a=s[t];s[t]=s[o],s[o]=a}return s},p=s=>s.toString().split("").map(Number).map(t=>(t||10)+64).map(t=>String.fromCharCode(t)).join(""),P=(s,t,o)=>{let a=0,e=n(s);return o||(e=e.concat(h(s))),e.forEach(l=>{l.forEach(r=>{r.result&&(r.team1.name==t&&r.result.team1Score>r.result.team2Score&&a++,r.team2.name==t&&r.result.team2Score>r.result.team1Score&&a++)})}),a},T=(s,t,o)=>{let a=0,e=n(s);return o||(e=e.concat(h(s))),e.forEach(l=>{l.forEach(r=>{r.result&&(r.team1._id==t&&(a+=r.result.team1Score),r.team2._id==t&&(a+=r.result.team2Score))})}),a},w=(s,t,o)=>{let a=0,e=n(s);return o||(e=e.concat(h(s))),e.forEach(l=>{l.forEach(r=>{r.result&&(r.team1.players[0]==t&&(a+=r.result.team1Player1Score),r.team1.players[1]==t&&(a+=r.result.team1Player2Score),r.team2.players[0]==t&&(a+=r.result.team2Player1Score),r.team2.players[1]==t&&(a+=r.result.team2Player2Score))})}),a},O=(s,t,o)=>{let a=0,e=n(s);return o||(e=e.concat(h(s))),e.forEach(l=>{l.forEach(r=>{r.result&&(r.team1._id==t&&(a+=r.result.team2Score),r.team2._id==t&&(a+=r.result.team1Score))})}),a},d=(s,t,o)=>{let a=0,e=n(s);return o||(e=e.concat(h(s))),e.forEach(l=>{l.forEach(r=>{r.result&&(r.team1.players[0]==t||r.team1.players[1]==t||r.team2.players[0]==t||r.team2.players[1]==t)&&a++})}),a},y=(s,t,o)=>{let a=!1;return n(s).forEach(l=>{l.forEach(r=>{r.result&&r.team1._id==t&&r.team2._id==o&&(a=r.result.team1Score>r.result.Team2ID)})}),a},M=(s,t,o)=>{let a=n(s);o||(a=a.concat(h(s)));let e=0,l=0;return a.forEach(r=>{r.forEach(m=>{m.result&&(m.team1._id==t._id&&(l+=m.result.team2Score),m.team2._id==t._id&&(l+=m.result.team1Score),m.team1._id==t._id&&m.result.team1Score<m.result.team2Score&&(e+=m.result.team2Score-m.result.team1Score),m.team2._id==t._id&&m.result.team1Score>m.result.team2Score&&(e+=m.result.team1Score-m.result.team2Score))})}),e+l},x=async s=>{let t=await i.post("/getTournamentByName",{tournamentName:s});if(console.log(t.data.message),t.data.success)return t.data.tournament},K=async s=>{let t="Weck BiPo Open "+s;s.includes("Kirmes")&&(t=s);let o=await i.post("/getTournamentByName",{tournamentName:t});if(console.log(o.data.message),o.data.success)return o.data.tournament},W=async(s,t)=>{let o=await i.post("/setSettings",{tournamentID:s,settings:t});return console.log(o.data.message),o.data.success},A=async(s,t)=>{let o=await i.post("/addTeam",{tournamentID:s,team:t});return console.log(o.data.message),o.data.success},C=async(s,t)=>{let o=await i.post("/editTeam",{tournamentID:s,team:t});return console.log(o.data.message),o.data.success},B=async(s,t)=>{let o=await i.post("/removeTeam",{tournamentID:s,teamID:t});return console.log(o.data.message),o.data.success},f=(s,t)=>s.teams.find(a=>a._id==t),b=(s,t)=>s.teams.find(a=>a.name==t),G=s=>{if(!s)return[];let t=[];return s.teams.forEach(o=>{t.push(o)}),t},H=s=>{if(!s)return[];let t=[],o=h(s);if(o.length>0){let a=o[o.length-1][0],e=a.result.team1Score>a.result.team2Score?a.team1:a.team2,l=a.result.team1Score>a.result.team2Score?a.team2:a.team1,r=o[o.length-1][1],m=r.result.team1Score>r.result.team2Score?r.team1:r.team2,c=r.result.team1Score>r.result.team2Score?r.team2:r.team1;t.push(e),t.push(l),t.push(m),t.push(c)}return t},D=s=>{if(!s||!s.groupPhase.groups)return[];let t=[];return s.groupPhase.groups.forEach((o,a)=>{t.push({teams:[]}),o.teams.forEach(e=>{let l=f(s,e.teamID);t[a].teams.push(l)})}),t},F=async(s,t)=>{let o=await i.post("/setGroups",{tournamentID:s,groups:t});return console.log(o.data.message),o.data.success},R=async s=>{let t=[],o=S(s.teams),a=s.settings.fixedGroupAmmount;for(let e=0;e<a;e++)t.push({teams:[]});for(let e=0;e<o.length;e++)t[e%a].teams.push({teamID:o[e]._id});await F(s._id,t)},z=s=>{if(!s)return[];let t=[];return D(s).forEach((a,e)=>{t.push({teams:[]}),a.teams.forEach(l=>{let r=l,m=T(s,r._id,!0),c=O(s,r._id,!0);r.wins=P(s,r.name,!0),r.games=d(s,r.players[0],!0),r.score=m+" : "+c,r.scoreDifference=m-c,r.hits=m,t[e].teams.push(r)})}),t.forEach(a=>{a.teams=a.teams.sort((e,l)=>e.hits==l.hits&&e.scoreDifference==l.scoreDifference&&e.wins==l.wins?y(s,e._id,l._id):l.scoreDifference==e.scoreDifference&&e.wins==l.wins?l.hits-e.hits:e.wins==l.wins?l.scoreDifference-e.scoreDifference:l.wins-e.wins)}),t},n=s=>{if(!s||!s.groupPhase.matches)return[];let t=[];return s.groupPhase.matches.forEach((o,a)=>{t.push([]),o.forEach(e=>{t[a].push({result:e.result,team1:f(s,e.team1ID),team2:f(s,e.team2ID),_id:e._id})})}),t},_=async(s,t)=>{let o=await i.post("/setMatchesGroupPhase",{tournamentID:s,matches:t});return console.log(o.data.message),o.data.success},L=async s=>{let t=[],o=D(s);for(let a=0;a<o.length;a++){let e=[],l=o[a].teams,r=l.length*(l.length-1)/2;if(r==6)e.push({team1ID:l[2].teamID,team2ID:l[3].teamID}),e.push({team1ID:l[0].teamID,team2ID:l[1].teamID}),e.push({team1ID:l[2].teamID,team2ID:l[1].teamID}),e.push({team1ID:l[0].teamID,team2ID:l[3].teamID}),e.push({team1ID:l[0].teamID,team2ID:l[2].teamID}),e.push({team1ID:l[1].teamID,team2ID:l[3].teamID}),t.push(e);else if(r==3)e.push({team1ID:l[0].teamID,team2ID:l[1].teamID}),e.push({team1ID:l[0].teamID,team2ID:l[2].teamID}),e.push({team1ID:l[1].teamID,team2ID:l[2].teamID}),t.push(e);else{for(let m=0;m<l.length;m++)for(let c=m+1;c<l.length;c++){let u={team1ID:l[c].teamID,team2ID:l[m].teamID};e.push(u)}e=S(e),t.push(e)}}await _(s._id,t)},N=async(s,t,o)=>{let a=s.groupPhase.matches;for(let e=0;e<a.length;e++)for(let l=0;l<a[e].length;l++)t==a[e][l]._id&&(a[e][l].result=o);await _(s._id,a),await E(s)},k=s=>{if(!s||!s.koPhase.matches)return[];let t=[];return s.koPhase.matches.forEach((o,a)=>{o.forEach(e=>{let l=f(s,e.team1ID);t.includes(l)||t.push(l);let r=f(s,e.team2ID);t.includes(r)||t.push(r)})}),t},h=s=>{if(!s||!s.koPhase.matches)return[];let t=[];return s.koPhase.matches.forEach((o,a)=>{t.push([]),o.forEach(e=>{t[a].push({placeHolderTeam1:e.placeHolderTeam1,placeHolderTeam2:e.placeHolderTeam2,result:e.result,team1:f(s,e.team1ID),team2:f(s,e.team2ID),_id:e._id})})}),t},I=async(s,t)=>{let o=await i.post("/setMatchesKOPhase",{tournamentID:s,matches:t});return console.log(o.data.message),o.data.success},j=async s=>{let t=[],o=s.settings.advancingTeamsPerGroup*s.groupPhase.groups.length,a=Math.log2(o);for(let e=0;e<a;e++){let l=o/Math.pow(2,e+1);if(t.push([]),e==0)for(let r=0;r<l;r++){let m,c;r%2==0?(m=p(r+1),c=p(r+2)):(m=p(l-r+1),c=p(l-r)),t[e].push({placeHolderTeam1:"1. Platz - Gruppe "+m,placeHolderTeam2:"2. Platz - Gruppe "+c})}else{for(let r=0;r<l;r++)t[e].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"});e==a-1&&t[e].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"})}}await I(s._id,t)},E=async s=>{let t=[],o=s.koPhase.matches,a=D(s);o.forEach((e,l)=>{if(t.push([]),l==0)for(let r=0;r<e.length;r++){let m=e[r],c,u;r%2==0?(c=r,u=r+1):(c=e.length-r,u=e.length-r-1),s.name=="Weck BiPo Open 2022"&&(r==0&&(c=2,u=0),r==1&&(c=3,u=1),r==2&&(c=0,u=3),r==3&&(c=1,u=2)),s.groupPhase.matches[c].find(g=>!g.result)||(m.team1ID=a[c].teams[0]._id),s.groupPhase.matches[u].find(g=>!g.result)||(m.team2ID=a[u].teams[1]._id),t[l].push(m)}else if(l==o.length-1){let r=e[0],m=e[1],c=o[l-1][0],u=o[l-1][1];c.result&&(r.team1ID=c.result.team1Score>c.result.team2Score?c.team1ID:c.team2ID,m.team1ID=c.result.team1Score>c.result.team2Score?c.team2ID:c.team1ID),u.result&&(r.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID,m.team2ID=u.result.team1Score>u.result.team2Score?u.team2ID:u.team1ID),t[l].push(r),t[l].push(m)}else for(let r=0;r<e.length;r++){let m=e[r],c=o[l-1][r*2],u=o[l-1][r*2+1];c.result&&(m.team1ID=c.result.team1Score>c.result.team2Score?c.team1ID:c.team2ID),u.result&&(m.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID),t[l].push(m)}}),await I(s._id,t)},q=async(s,t,o)=>{let a=s.koPhase.matches;for(let e=0;e<a.length;e++)for(let l=0;l<a[e].length;l++)t==a[e][l]._id&&(a[e][l].result=o);await I(s._id,a),await E(s)},V=s=>{let t=[];k(s).forEach(a=>{let e=a,l=T(s,e._id,!1),r=O(s,e._id,!1);e.wins=P(s,e.name,!1),e.games=d(s,e.players[0],!1),e.score=l+" : "+r,e.scoreDifference=l-r,e.hits=l,t.push(e)}),t=t.sort((a,e)=>a.games==e.games?e.wins-a.wins:e.games-a.games);for(let a=0;a<t.length;a++){t[a].placement=a;let e=H(s);if(!e.includes(t[a])){let l=t.filter(r=>r.games==t[a].games);l.length>1&&l.forEach(r=>{r.placement=l[0].placement})}e.includes(t[a])&&(t[a].placement=e.indexOf(t[a]))}return t=t.sort((a,e)=>a.placement-e.placement),t},J=s=>{if(!s)return[];let t=[],o=G(s);for(let a=0;a<o.length;a++)for(let e=0;e<o[a].players.length;e++){let l={name:o[a].players[e],score:w(s,o[a].players[e],!1),ammountOfMatches:d(s,o[a].players[e],!1),ammountOfDrunkenCups:Math.ceil(M(s,o[a],!1)/2)};l.averageScore=(l.ammountOfMatches==0?0:l.score/l.ammountOfMatches).toFixed(2),t.push(l)}t.sort((a,e)=>e.averageScore==a.averageScore?e.ammountOfDrunkenCups-a.ammountOfDrunkenCups:e.averageScore-a.averageScore);for(let a=0;a<t.length;a++){t[a].placement=a;let e=t.filter(l=>l.averageScore==t[a].averageScore&&l.ammountOfDrunkenCups==t[a].ammountOfDrunkenCups);e.length>1&&e.forEach(l=>{l.placement=e[0].placement})}return t};export{z as a,V as b,p as c,J as d,n as e,G as f,K as g,H as h,h as i,M as j,A as k,C as l,D as m,b as n,F as o,L as p,j as q,B as r,W as s,R as t,x as u,_ as v,N as w,q as x};
