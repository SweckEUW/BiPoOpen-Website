import{s as i}from"./index-f915d939.js";const d=s=>{for(var t=s.length-1;t>0;t--){var l=Math.floor(Math.random()*(t+1)),a=s[t];s[t]=s[l],s[l]=a}return s},h=s=>s.toString().split("").map(Number).map(t=>(t||10)+64).map(t=>String.fromCharCode(t)).join(""),T=(s,t,l)=>{let a=0,e=f(s);return l||(e=e.concat(n(s))),e.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.name==t&&o.result.team1Score>o.result.team2Score&&(a+=1),o.team2.name==t&&o.result.team2Score>o.result.team1Score&&(a+=1))})}),a},_=(s,t,l)=>{let a=0,e=f(s);return l||(e=e.concat(n(s))),e.forEach(r=>{r.forEach(o=>{o.result&&(o.team1._id==t&&(a+=o.result.team1Score),o.team2._id==t&&(a+=o.result.team2Score))})}),a},y=(s,t,l)=>{let a=0,e=f(s);return l||(e=e.concat(n(s))),e.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.players[0]==t&&(a+=o.result.team1Player1Score),o.team1.players[1]==t&&(a+=o.result.team1Player2Score),o.team2.players[0]==t&&(a+=o.result.team2Player1Score),o.team2.players[1]==t&&(a+=o.result.team2Player2Score))})}),a},O=(s,t,l)=>{let a=0,e=f(s);return l||(e=e.concat(n(s))),e.forEach(r=>{r.forEach(o=>{o.result&&(o.team1._id==t&&(a+=o.result.team2Score),o.team2._id==t&&(a+=o.result.team1Score))})}),a},I=(s,t,l)=>{let a=0,e=f(s);return l||(e=e.concat(n(s))),e.forEach(r=>{r.forEach(o=>{o.result&&(o.team1.players[0]==t&&a++,o.team1.players[1]==t&&a++,o.team2.players[0]==t&&a++,o.team2.players[1]==t&&a++)})}),a},w=(s,t,l)=>{let a=!1;return f(s).forEach(r=>{r.forEach(o=>{o.result&&o.team1._id==t&&o.team2._id==l&&(a=o.result.team1Score>o.result.Team2ID)})}),a},E=(s,t,l)=>{let a=f(s);l||(a=a.concat(n(s)));let e=0,r=0;return a.forEach(o=>{o.forEach(m=>{m.result&&(m.team1._id==t._id&&(r+=m.result.team2Score),m.team2._id==t._id&&(r+=m.result.team1Score),m.team1._id==t._id&&m.result.team1Score<m.result.team2Score&&(e+=m.result.team2Score-m.result.team1Score),m.team2._id==t._id&&m.result.team1Score>m.result.team2Score&&(e+=m.result.team1Score-m.result.team2Score))})}),e+r},F=async s=>{let t=await i.post("/getTournamentByName",{tournamentName:s});if(console.log(t.data.message),t.data.success)return t.data.tournament},k=async s=>{let t="Weck BiPo Open "+s;s.includes("Kirmes")&&(t=s);let l=await i.post("/getTournamentByName",{tournamentName:t});if(console.log(l.data.message),l.data.success)return l.data.tournament},x=async(s,t)=>{let l=await i.post("/setSettings",{tournamentID:s,settings:t});return console.log(l.data.message),l.data.success},C=async(s,t)=>{let l=await i.post("/addTeam",{tournamentID:s,team:t});return console.log(l.data.message),l.data.success},A=async(s,t)=>{let l=await i.post("/editTeam",{tournamentID:s,team:t});return console.log(l.data.message),l.data.success},B=async(s,t)=>{let l=await i.post("/removeTeam",{tournamentID:s,teamID:t});return console.log(l.data.message),l.data.success},p=(s,t)=>s.teams.find(a=>a._id==t),W=(s,t)=>s.teams.find(a=>a.name==t),M=s=>{if(!s||!s.groupPhase.groups)return[];let t=[];return s.groupPhase.groups.forEach((l,a)=>{t.push({teams:[]}),l.teams.forEach(e=>{let r=p(s,e.teamID);t[a].teams.push(r)})}),t},G=async(s,t)=>{let l=await i.post("/setGroups",{tournamentID:s,groups:t});return console.log(l.data.message),l.data.success},K=async s=>{let t=[],l=d(s.teams),a=s.settings.fixedGroupAmmount;for(let e=0;e<a;e++)t.push({teams:[]});for(let e=0;e<l.length;e++)t[e%a].teams.push({teamID:l[e]._id});await G(s._id,t)},H=s=>{let t=[];return M(s).forEach((l,a)=>{t.push({teams:[]}),l.teams.forEach(e=>{let r=e,o=_(s,r._id,!0),m=O(s,r._id,!0);r.wins=T(s,r.name,!0),r.games=I(s,r.players[0],!0),r.score=o+" : "+m,r.scoreDifference=o-m,r.hits=o,t[a].teams.push(r)})}),t.forEach(l=>{l.teams=l.teams.sort((a,e)=>a.hits==e.hits&&a.scoreDifference==e.scoreDifference&&a.wins==e.wins?w(s,a._id,e._id):e.scoreDifference==a.scoreDifference&&a.wins==e.wins?e.hits-a.hits:a.wins==e.wins?e.scoreDifference-a.scoreDifference:e.wins-a.wins)}),t},f=s=>{if(!s||!s.groupPhase.matches)return[];let t=[];return s.groupPhase.matches.forEach((l,a)=>{t.push([]),l.forEach(e=>{t[a].push({result:e.result,team1:p(s,e.team1ID),team2:p(s,e.team2ID),_id:e._id})})}),t},S=async(s,t)=>{let l=await i.post("/setMatchesGroupPhase",{tournamentID:s,matches:t});return console.log(l.data.message),l.data.success},b=async s=>{let t=[],l=s.groupPhase.groups;for(let a=0;a<l.length;a++){let e=[],r=l[a].teams,o=r.length*(r.length-1)/2;if(o==6)e.push({team1ID:r[2].teamID,team2ID:r[3].teamID}),e.push({team1ID:r[0].teamID,team2ID:r[1].teamID}),e.push({team1ID:r[2].teamID,team2ID:r[1].teamID}),e.push({team1ID:r[0].teamID,team2ID:r[3].teamID}),e.push({team1ID:r[0].teamID,team2ID:r[2].teamID}),e.push({team1ID:r[1].teamID,team2ID:r[3].teamID}),t.push(e);else if(o==3)e.push({team1ID:r[0].teamID,team2ID:r[1].teamID}),e.push({team1ID:r[0].teamID,team2ID:r[2].teamID}),e.push({team1ID:r[1].teamID,team2ID:r[2].teamID}),t.push(e);else{for(let m=0;m<r.length;m++)for(let c=m+1;c<r.length;c++){let u={team1ID:r[c].teamID,team2ID:r[m].teamID};e.push(u)}e=d(e),t.push(e)}}await S(s._id,t)},R=async(s,t,l)=>{let a=s.groupPhase.matches;for(let e=0;e<a.length;e++)for(let r=0;r<a[e].length;r++)t==a[e][r]._id&&(a[e][r].result=l);await S(s._id,a),await P(s)},n=s=>{if(!s||!s.koPhase.matches)return[];let t=[];return s.koPhase.matches.forEach((l,a)=>{t.push([]),l.forEach(e=>{t[a].push({placeHolderTeam1:e.placeHolderTeam1,placeHolderTeam2:e.placeHolderTeam2,result:e.result,team1:p(s,e.team1ID),team2:p(s,e.team2ID),_id:e._id})})}),t},D=async(s,t)=>{let l=await i.post("/setMatchesKOPhase",{tournamentID:s,matches:t});return console.log(l.data.message),l.data.success},z=async s=>{let t=[],l=s.settings.advancingTeamsPerGroup*s.groupPhase.groups.length,a=Math.log2(l);for(let e=0;e<a;e++){let r=l/Math.pow(2,e+1);if(t.push([]),e==0)for(let o=0;o<r;o++){let m,c;o%2==0?(m=h(o+1),c=h(o+2)):(m=h(r-o+1),c=h(r-o)),t[e].push({placeHolderTeam1:"1. Platz - Gruppe "+m,placeHolderTeam2:"2. Platz - Gruppe "+c})}else{for(let o=0;o<r;o++)t[e].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"});e==a-1&&t[e].push({placeHolderTeam1:"TBD",placeHolderTeam2:"TBD"})}}await D(s._id,t)},P=async s=>{let t=[],l=s.koPhase.matches,a=H(s);l.forEach((e,r)=>{if(t.push([]),r==0)for(let o=0;o<e.length;o++){let m=e[o],c,u;o%2==0?(c=o,u=o+1):(c=e.length-o,u=e.length-o-1),s.name=="Weck BiPo Open 2022"&&(o==0&&(c=2,u=0),o==1&&(c=3,u=1),o==2&&(c=0,u=3),o==3&&(c=1,u=2)),s.groupPhase.matches[c].find(g=>!g.result)||(m.team1ID=a[c].teams[0]._id),s.groupPhase.matches[u].find(g=>!g.result)||(m.team2ID=a[u].teams[1]._id),t[r].push(m)}else if(r==l.length-1){let o=e[0],m=e[1],c=l[r-1][0],u=l[r-1][1];c.result&&(o.team1ID=c.result.team1Score>c.result.team2Score?c.team1ID:c.team2ID,m.team1ID=c.result.team1Score>c.result.team2Score?c.team2ID:c.team1ID),u.result&&(o.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID,m.team2ID=u.result.team1Score>u.result.team2Score?u.team2ID:u.team1ID),t[r].push(o),t[r].push(m)}else for(let o=0;o<e.length;o++){let m=e[o],c=l[r-1][o*2],u=l[r-1][o*2+1];c.result&&(m.team1ID=c.result.team1Score>c.result.team2Score?c.team1ID:c.team2ID),u.result&&(m.team2ID=u.result.team1Score>u.result.team2Score?u.team1ID:u.team2ID),t[r].push(m)}}),await D(s._id,t)},L=async(s,t,l)=>{let a=s.koPhase.matches;for(let e=0;e<a.length;e++)for(let r=0;r<a[e].length;r++)t==a[e][r]._id&&(a[e][r].result=l);await D(s._id,a),await P(s)},N=s=>{let t=[],l=s.teams;if(!l)return[];for(let a=0;a<l.length;a++)for(let e=0;e<l[a].players.length;e++){let r={name:l[a].players[e],score:y(s,l[a].players[e],!1),ammountOfMatches:I(s,l[a].players[e],!1),ammountOfDrunkenCups:Math.ceil(E(s,l[a],!1)/2)};r.averageScore=(r.ammountOfMatches==0?0:r.score/r.ammountOfMatches).toFixed(2),t.push(r)}t.sort((a,e)=>e.averageScore==a.averageScore?e.ammountOfDrunkenCups-a.ammountOfDrunkenCups:e.averageScore-a.averageScore);for(let a=0;a<t.length;a++){t[a].placement=a;let e=t.filter(r=>r.averageScore==t[a].averageScore&&r.ammountOfDrunkenCups==t[a].ammountOfDrunkenCups);e.length>1&&e.forEach(r=>{r.placement=e[0].placement})}return t};export{H as a,M as b,h as c,N as d,f as e,p as f,k as g,C as h,A as i,W as j,G as k,b as l,z as m,K as n,F as o,S as p,n as q,B as r,x as s,R as t,L as u};
