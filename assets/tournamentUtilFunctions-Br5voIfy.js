import{C as c}from"./index-AeagG3uj.js";const P=e=>{for(var t=e.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1)),o=e[t];e[t]=e[r],e[r]=o}return e},b=e=>e.toString().split("").map(Number).map(t=>(t||10)+64).map(t=>String.fromCharCode(t)).join(""),O=(e,t,r)=>{let o=0;return p(e,t,r).forEach(s=>{s.team1.name==t&&s.result.team1Score>s.result.team2Score&&o++,s.team2.name==t&&s.result.team2Score>s.result.team1Score&&o++}),o},E=(e,t,r)=>{let o=0;return p(e,t,r).forEach(s=>{s.team1.name==t&&(o+=s.result.team1Score),s.team2.name==t&&(o+=s.result.team2Score)}),o},F=(e,t,r)=>{let o=0;return p(e,t,r).forEach(s=>{s.team1.name==t&&(o+=s.result.team2Score),s.team2.name==t&&(o+=s.result.team1Score)}),o},G=(e,t,r)=>{let o=0,a=0;return p(e,t,r).forEach(l=>{l.team1.name==t&&(a+=l.result.team2Score),l.team2.name==t&&(a+=l.result.team1Score),l.team1.name==t&&l.result.team1Score<l.result.team2Score&&(o+=l.result.team2Score-l.result.team1Score),l.team2.name==t&&l.result.team1Score>l.result.team2Score&&(o+=l.result.team1Score-l.result.team2Score)}),o+a},v=(e,t,r)=>{if(!e.settings.trackPlayerShots)return 0;let o=0;return d(e,t,r).forEach(s=>{s.team1.players[0]==t&&(o+=s.result.team1Player1Score),s.team1.players[1]==t&&(o+=s.result.team1Player2Score),s.team2.players[0]==t&&(o+=s.result.team2Player1Score),s.team2.players[1]==t&&(o+=s.result.team2Player2Score)}),o},y=(e,t,r)=>d(e,t,r).length,k=(e,t,r)=>{let o=0;return d(e,t,r).forEach(s=>{(s.team1.players[0]==t||s.team1.players[1]==t)&&s.result.team1Score>s.result.team2Score&&o++,(s.team2.players[0]==t||s.team2.players[1]==t)&&s.result.team2Score>s.result.team1Score&&o++}),o},W=(e,t,r)=>{let o=!1;return D(e).forEach(s=>{s.forEach(l=>{l.result&&l.team1.name==t&&l.team2.name==r&&(o=l.result.team1Score>l.result.team2Score)})}),o},B=async e=>{let t=await c.post("/createTournament",e);return console.log(t.data.message),t.data.success},R=async()=>{let e=await c.get("/tournaments");if(console.log(e.data.message),e.data.success)return e.data.tournaments},V=async e=>{let t=await c.post("/getTournamentByName",{tournamentName:e});if(console.log(t.data.message),t.data.success)return t.data.tournament},j=async e=>{let t=e.replaceAll("-"," ");(e=="2020"||e=="2021"||e=="2022"||e=="2023"||e=="2024"||e=="2025"||e=="2026"||e=="2027")&&(t="Weck BiPo Open "+e);let r=await c.post("/getTournamentByName",{tournamentName:t});if(console.log(r.data.message),r.data.success)return r.data.tournament},q=async(e,t)=>{let r=await c.post("/setSettings",{tournamentID:e,settings:t});return console.log(r.data.message),r.data.success},A=e=>{if(!e)return[];let t=[],r=C(e);for(let o=0;o<r.length;o++)for(let a=0;a<r[o].players.length;a++){let s=y(e,r[o].players[a],!1),l=v(e,r[o].players[a],!1),m=k(e,r[o].players[a],!1),u={name:r[o].players[a],score:l,ammountOfMatches:s,ammountOfMatchesWithTrackedShots:e.settings.trackPlayerShots?s:0,ammountOfDrunkenCups:Math.ceil(G(e,r[o].name,!1)/2),wins:m,averageScore:Math.round((s==0?0:l/s)*100)/100,averageWins:Math.round((s==0?0:m/s)*100)/100};t.push(u)}return t},L=e=>{let t=A(e);t.sort((r,o)=>o.averageScore==r.averageScore?o.ammountOfDrunkenCups-r.ammountOfDrunkenCups:o.averageScore-r.averageScore);for(let r=0;r<t.length;r++){t[r].placement=r;let o=t.filter(a=>a.averageScore==t[r].averageScore&&a.ammountOfDrunkenCups==t[r].ammountOfDrunkenCups);o.length>1&&o.forEach(a=>{a.placement=o[0].placement})}return t},d=(e,t,r)=>{let o=[],a=D(e);return r||(a=a.concat(T(e))),a.forEach(s=>{s.forEach(l=>{l.result&&(l.team1.players[0]==t||l.team1.players[1]==t||l.team2.players[0]==t||l.team2.players[1]==t)&&o.push({_id:l._id,team1:l.team1,team2:l.team2,result:l.result})})}),o},z=async(e,t)=>{let r=await c.post("/addTeam",{tournamentID:e,team:t});return console.log(r.data.message),r.data.success},J=async(e,t)=>{let r=await c.post("/editTeam",{tournamentID:e,team:t});return console.log(r.data.message),r.data.success},Q=async(e,t)=>{let r=await c.post("/removeTeam",{tournamentID:e,teamID:t});return console.log(r.data.message),r.data.success},h=(e,t)=>e.teams.find(o=>o._id==t),U=(e,t)=>e.teams.find(o=>o.name==t),C=e=>{if(!e)return[];let t=[];return e.teams.forEach(r=>{t.push(r)}),t},p=(e,t,r)=>{let o=[],a=D(e);return r||(a=a.concat(T(e))),a.forEach(s=>{s.forEach(l=>{l.result&&(l.team1.name==t||l.team2.name==t)&&o.push({_id:l._id,team1:l.team1,team2:l.team2,result:l.result})})}),o},g=e=>{if(!e||!e.groupPhase.groups)return[];let t=[];return e.groupPhase.groups.forEach((r,o)=>{let a=[];t.push({teams:a}),r.teams.forEach(s=>{let l=h(e,s.teamID);t[o].teams.push(l)})}),t},x=async(e,t)=>{let r=await c.post("/setGroups",{tournamentID:e,groups:t});return console.log(r.data.message),r.data.success},X=async e=>{let t=[],r=P(e.teams),o=e.settings.fixedGroupAmmount;for(let a=0;a<o;a++)t.push({teams:[]});for(let a=0;a<r.length;a++)t[a%o].teams.push({teamID:r[a]._id});await x(e._id,t)},K=e=>{let t=[],r=g(e);for(let o=0;o<r.length;o++){t.push({teams:[]});for(let a=0;a<r[o].teams.length;a++){let s=E(e,r[o].teams[a].name,!0),l=F(e,r[o].teams[a].name,!0),m={name:r[o].teams[a].name,players:r[o].teams[a].players,wins:O(e,r[o].teams[a].name,!0),games:y(e,r[o].teams[a].players[0],!0),score:s+" : "+l,scoreDifference:s-l,hits:s};t[o].teams.push(m)}}return t.forEach(o=>{o.teams=o.teams.sort((a,s)=>a.hits==s.hits&&a.scoreDifference==s.scoreDifference&&a.wins==s.wins?W(e,a.name,s.name)?1:-1:s.scoreDifference==a.scoreDifference&&a.wins==s.wins?s.hits-a.hits:a.wins==s.wins?s.scoreDifference-a.scoreDifference:s.wins-a.wins)}),t},D=e=>{if(!e||!e.groupPhase.matches)return[];let t=[];return e.groupPhase.matches.forEach((r,o)=>{t.push([]),r.forEach(a=>{t[o].push({result:a.result,team1:h(e,a.team1ID),team2:h(e,a.team2ID),_id:a._id})})}),t},w=async(e,t)=>{let r=await c.post("/setMatchesGroupPhase",{tournamentID:e,matches:t});return console.log(r.data.message),r.data.success},Y=async e=>{let t=[],r=g(e);for(let o=0;o<r.length;o++){let a=[],s=r[o].teams,l=s.length*(s.length-1)/2;if(l==10)a.push({team1ID:s[0]._id,team2ID:s[1]._id,_id:""}),a.push({team1ID:s[2]._id,team2ID:s[3]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[4]._id,_id:""}),a.push({team1ID:s[1]._id,team2ID:s[3]._id,_id:""}),a.push({team1ID:s[2]._id,team2ID:s[4]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[3]._id,_id:""}),a.push({team1ID:s[1]._id,team2ID:s[2]._id,_id:""}),a.push({team1ID:s[3]._id,team2ID:s[4]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[2]._id,_id:""}),a.push({team1ID:s[1]._id,team2ID:s[4]._id,_id:""});else if(l==6)a.push({team1ID:s[2]._id,team2ID:s[3]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[1]._id,_id:""}),a.push({team1ID:s[2]._id,team2ID:s[1]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[3]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[2]._id,_id:""}),a.push({team1ID:s[1]._id,team2ID:s[3]._id,_id:""});else if(l==3)a.push({team1ID:s[0]._id,team2ID:s[1]._id,_id:""}),a.push({team1ID:s[0]._id,team2ID:s[2]._id,_id:""}),a.push({team1ID:s[1]._id,team2ID:s[2]._id,_id:""});else{for(let m=0;m<s.length;m++)for(let u=m+1;u<s.length;u++){let i={team1ID:s[u]._id,team2ID:s[m]._id,_id:""};a.push(i)}a=P(a)}t.push(a)}await w(e._id,t)},Z=async(e,t,r)=>{let o=e.groupPhase.matches;for(let a=0;a<o.length;a++)for(let s=0;s<o[a].length;s++)t==o[a][s]._id&&(o[a][s].result=r);await w(e._id,o),await M(e)},T=e=>{if(!e||!e.koPhase.matches)return[];let t=[];return e.koPhase.matches.forEach((r,o)=>{t.push([]),r.forEach(a=>{t[o].push({result:a.result,team1:h(e,a.team1ID),team2:h(e,a.team2ID),_id:a._id})})}),t},_=async(e,t)=>{let r=await c.post("/setMatchesKOPhase",{tournamentID:e,matches:t});return console.log(r.data.message),r.data.success},$=async e=>{let t=[],r=e.settings.advancingTeamsPerGroup*e.groupPhase.groups.length;if(Math.log2(r)%1!=0){let a=1;for(;a<r;)a*=2;r=a}let o=Math.log2(r);for(let a=0;a<o;a++){let s=r/Math.pow(2,a+1);t.push([]);for(let l=0;l<s;l++){let m={_id:""};t[a].push(m)}a==o-1&&t[a].push({_id:""})}await _(e._id,t)},M=async e=>{let t=[],r=e.koPhase.matches,o=g(e),a=K(e);r.forEach((s,l)=>{if(t.push([]),l==0)for(let m=0;m<s.length;m++){let u=s[m],i,n,I=0,S=1;m%2==0?(i=m,n=m+1):(i=s.length-m,n=s.length-m-1),e.name=="SCW 3 Karneval 2025"&&(m==0&&(i=2,n=1),m==1&&(I=1,S=0,i=1,n=0)),e.name=="Weck BiPo Open 2022"&&(m==0&&(i=2,n=0),m==1&&(i=3,n=1),m==2&&(i=0,n=3),m==3&&(i=1,n=2)),e.groupPhase.matches[i].find(f=>!f.result)||(u.team1ID=o[i].teams.find(f=>f.name==a[i].teams[I].name)._id),e.groupPhase.matches[n].find(f=>!f.result)||(u.team2ID=o[n].teams.find(f=>f.name==a[n].teams[S].name)._id),t[l].push(u)}else if(l==r.length-1){let m=s[0],u=s[1],i=r[l-1][0],n=r[l-1][1];i.result&&(m.team1ID=i.result.team1Score>i.result.team2Score?i.team1ID:i.team2ID,u.team1ID=i.result.team1Score>i.result.team2Score?i.team2ID:i.team1ID),n.result&&(m.team2ID=n.result.team1Score>n.result.team2Score?n.team1ID:n.team2ID,u.team2ID=n.result.team1Score>n.result.team2Score?n.team2ID:n.team1ID),t[l].push(m),t[l].push(u)}else for(let m=0;m<s.length;m++){let u=s[m],i=r[l-1][m*2],n=r[l-1][m*2+1];i.result&&(u.team1ID=i.result.team1Score>i.result.team2Score?i.team1ID:i.team2ID),n.result&&(u.team2ID=n.result.team1Score>n.result.team2Score?n.team1ID:n.team2ID),t[l].push(u)}}),await _(e._id,t)},N=async(e,t,r)=>{let o=e.koPhase.matches;for(let a=0;a<o.length;a++)for(let s=0;s<o[a].length;s++)t==o[a][s]._id&&(o[a][s].result=r);await _(e._id,o),await M(e)};export{A as a,L as b,R as c,B as d,z as e,J as f,j as g,U as h,x as i,X as j,Y as k,$ as l,b as m,g as n,V as o,Z as p,N as q,Q as r,q as s,D as t,K as u,w as v,T as w};
